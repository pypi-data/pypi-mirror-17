#!/usr/bin/env python

from __future__ import print_function
import json
from sys import argv
from constrictor import DPKGBuilder

DEFAULT_CONFIG_PATH = "./build-config.json"


def build_package(build_config_path, print_output_path):
    with open(build_config_path) as config_fp:
        config = json.load(config_fp)

    output_directory = './build'

    d = DPKGBuilder(output_directory, config['project_name'], config["version"], config["architecture"],
                    config.get("directories"), config.get("links"), config.get("depends"),
                    config.get("maintainer_scripts"))

    output_path = d.build_package()

    if print_output_path:
        print(output_path)


def main():
    args = argv

    if "-p" in args:
        print_output_path = True
        args.remove("-p")
    else:
        print_output_path = False

    build_package(args[1] if len(argv) > 1 else DEFAULT_CONFIG_PATH, print_output_path)


if __name__ == '__main__':
    main()
