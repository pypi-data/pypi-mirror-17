<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pydna.amplify &mdash; Pydna 0.8.1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.8.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="Pydna 0.8.1 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">Pydna 0.8.1 documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for pydna.amplify</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="c"># doctest: +NORMALIZE_WHITESPACE</span>
<span class="c"># doctest: +SKIP</span>
<span class="sd">&#39;&#39;&#39;This module provides functions for PCR. Primers with 5&#39; tails as well as inverse PCR on</span>
<span class="sd">circular templates are handled correctly.</span>

<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">textwrap</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">operator</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">math</span>                           <span class="kn">import</span> <span class="n">log10</span>
<span class="kn">from</span> <span class="nn">Bio.Seq</span>                        <span class="kn">import</span> <span class="n">Seq</span>
<span class="kn">from</span> <span class="nn">Bio.Alphabet.IUPAC</span>             <span class="kn">import</span> <span class="n">ambiguous_dna</span>
<span class="kn">from</span> <span class="nn">Bio.SeqRecord</span>                  <span class="kn">import</span> <span class="n">SeqRecord</span>
<span class="kn">from</span> <span class="nn">Bio.SeqUtils</span>                   <span class="kn">import</span> <span class="n">GC</span>
<span class="kn">from</span> <span class="nn">Bio.SeqUtils.CheckSum</span>          <span class="kn">import</span> <span class="n">seguid</span>
<span class="kn">from</span> <span class="nn">Bio.SeqUtils.MeltingTemp</span>       <span class="kn">import</span> <span class="n">Tm_staluc</span>
<span class="kn">from</span> <span class="nn">Bio.SeqFeature</span>                 <span class="kn">import</span> <span class="n">SeqFeature</span>
<span class="kn">from</span> <span class="nn">Bio.SeqFeature</span>                 <span class="kn">import</span> <span class="n">CompoundLocation</span>
<span class="kn">from</span> <span class="nn">Bio.SeqFeature</span>                 <span class="kn">import</span> <span class="n">FeatureLocation</span>
<span class="kn">from</span> <span class="nn">pydna.dsdna</span>                    <span class="kn">import</span> <span class="n">rc</span>
<span class="kn">from</span> <span class="nn">pydna.dsdna</span>                    <span class="kn">import</span> <span class="n">parse</span>
<span class="kn">from</span> <span class="nn">pydna.dsdna</span>                    <span class="kn">import</span> <span class="n">Dseqrecord</span>
<span class="kn">from</span> <span class="nn">pydna.pretty</span>                   <span class="kn">import</span> <span class="n">pretty_str</span>
<span class="kn">import</span> <span class="nn">shelve</span>

<span class="k">def</span> <span class="nf">_annealing_positions</span><span class="p">(</span><span class="n">primer</span><span class="p">,</span> <span class="n">template</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">15</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Finds the annealing position(s) for a primer on a template where the</span>
<span class="sd">    primer anneals perfectly with at least limit nucleotides in the 3&#39; part.</span>

<span class="sd">    start is a position (integer)</span>
<span class="sd">    footprint1 and tail1 are strings.</span>

<span class="sd">    ::</span>

<span class="sd">        &lt;- - - - - - - - - - template - - - - - - - - - - - - - &gt;</span>

<span class="sd">        &lt;------------- start ----&gt;</span>
<span class="sd">     5&#39;-...gctactacacacgtactgactgcctccaagatagagtcagtaaccacactcgat...3&#39;</span>
<span class="sd">           ||||||||||||||||||||||||||||||||||||||||||||||||</span>
<span class="sd">                                  3&#39;-gttctatctcagtcattggtgtATAGTG-5&#39;</span>

<span class="sd">                                                        &lt;tail&gt;</span>
<span class="sd">                                     &lt;---footprint-----&gt;</span>
<span class="sd">                                     &lt;--------- primer ------&gt;</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    primer : string</span>
<span class="sd">        The primer sequence 5&#39;-3&#39;</span>

<span class="sd">    template : string</span>
<span class="sd">        The template sequence 5&#39;-3&#39;</span>

<span class="sd">    limit : int = 15, optional</span>
<span class="sd">        footprint needs to be at least of length limit.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    describe : list of tuples (int, string, string)</span>
<span class="sd">        [ (start1, footprint1, tail1), (start2, footprint2, tail2),..., ]</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">primer</span><span class="p">)</span><span class="o">&lt;</span><span class="n">limit</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="n">prc</span> <span class="o">=</span> <span class="n">rc</span><span class="p">(</span><span class="n">primer</span><span class="p">)</span>
    <span class="n">head</span> <span class="o">=</span> <span class="n">prc</span><span class="p">[:</span><span class="n">limit</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

    <span class="n">table</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;R&quot;</span><span class="p">:</span><span class="s">&quot;(A|G)&quot;</span><span class="p">,</span>
             <span class="s">&quot;Y&quot;</span><span class="p">:</span><span class="s">&quot;(C|T)&quot;</span><span class="p">,</span>
             <span class="s">&quot;S&quot;</span><span class="p">:</span><span class="s">&quot;(G|C)&quot;</span><span class="p">,</span>
             <span class="s">&quot;W&quot;</span><span class="p">:</span><span class="s">&quot;(A|T)&quot;</span><span class="p">,</span>
             <span class="s">&quot;K&quot;</span><span class="p">:</span><span class="s">&quot;(G|T)&quot;</span><span class="p">,</span>
             <span class="s">&quot;M&quot;</span><span class="p">:</span><span class="s">&quot;(A|C)&quot;</span><span class="p">,</span>
             <span class="s">&quot;B&quot;</span><span class="p">:</span><span class="s">&quot;(C|G|T)&quot;</span><span class="p">,</span>
             <span class="s">&quot;D&quot;</span><span class="p">:</span><span class="s">&quot;(A|G|T)&quot;</span><span class="p">,</span>
             <span class="s">&quot;H&quot;</span><span class="p">:</span><span class="s">&quot;(A|C|T)&quot;</span><span class="p">,</span>
             <span class="s">&quot;V&quot;</span><span class="p">:</span><span class="s">&quot;(A|C|G)&quot;</span><span class="p">,</span>
             <span class="s">&quot;N&quot;</span><span class="p">:</span><span class="s">&quot;(A|G|C|T)&quot;</span><span class="p">}</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">table</span><span class="p">:</span>
        <span class="n">head</span><span class="o">=</span><span class="n">head</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">table</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

    <span class="n">positions</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="s">&#39;(?={})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">head</span><span class="p">),</span> <span class="n">template</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)]</span>

    <span class="k">if</span> <span class="n">positions</span><span class="p">:</span>
        <span class="n">tail</span> <span class="o">=</span> <span class="n">prc</span><span class="p">[</span><span class="n">limit</span><span class="p">:]</span>
        <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tail</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">match_start</span> <span class="ow">in</span> <span class="n">positions</span><span class="p">:</span>
            <span class="n">tm</span> <span class="o">=</span> <span class="n">template</span><span class="p">[</span><span class="n">match_start</span><span class="o">+</span><span class="n">limit</span><span class="p">:</span><span class="n">match_start</span><span class="o">+</span><span class="n">limit</span><span class="o">+</span><span class="n">length</span><span class="p">]</span>
            <span class="n">footprint</span> <span class="o">=</span> <span class="n">rc</span><span class="p">(</span><span class="n">template</span><span class="p">[</span><span class="n">match_start</span><span class="p">:</span><span class="n">match_start</span><span class="o">+</span><span class="n">limit</span><span class="p">]</span><span class="o">+</span><span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">b</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">takewhile</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tail</span><span class="p">,</span> <span class="n">tm</span><span class="p">))]))</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">match_start</span><span class="p">,</span> <span class="n">footprint</span><span class="p">,</span> <span class="n">primer</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">primer</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">footprint</span><span class="p">)</span> <span class="p">]))</span>
        <span class="k">return</span> <span class="n">results</span>
    <span class="k">return</span> <span class="p">[]</span>

<div class="viewcode-block" id="Primer"><a class="viewcode-back" href="../../pydna.html#pydna.amplify.Primer">[docs]</a><span class="k">class</span> <span class="nc">Primer</span><span class="p">(</span><span class="n">SeqRecord</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;This class holds information about a primer on a template &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">seq_obj</span><span class="p">,</span>
                 <span class="n">position</span><span class="p">,</span>
                 <span class="n">footprint</span><span class="p">,</span>
                 <span class="n">tail</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">position</span>  <span class="o">=</span> <span class="n">position</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">footprint</span> <span class="o">=</span> <span class="n">footprint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tail</span>      <span class="o">=</span> <span class="n">tail</span>

        <span class="n">seq_obj</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">alphabet</span> <span class="o">=</span> <span class="n">ambiguous_dna</span>

        <span class="n">SeqRecord</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                           <span class="n">seq</span><span class="o">=</span><span class="n">seq_obj</span><span class="o">.</span><span class="n">seq</span><span class="p">,</span>
                           <span class="nb">id</span><span class="o">=</span><span class="n">seq_obj</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                           <span class="n">name</span><span class="o">=</span><span class="n">seq_obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                           <span class="n">description</span><span class="o">=</span><span class="n">seq_obj</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
                           <span class="n">dbxrefs</span><span class="o">=</span><span class="n">seq_obj</span><span class="o">.</span><span class="n">dbxrefs</span><span class="p">,</span>
                           <span class="n">features</span><span class="o">=</span><span class="n">seq_obj</span><span class="o">.</span><span class="n">features</span><span class="p">,</span>
                           <span class="n">annotations</span><span class="o">=</span><span class="n">seq_obj</span><span class="o">.</span><span class="n">annotations</span><span class="p">,</span>
                           <span class="n">letter_annotations</span><span class="o">=</span><span class="n">seq_obj</span><span class="o">.</span><span class="n">letter_annotations</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Amplicon"><a class="viewcode-back" href="../../pydna.html#pydna.amplify.Amplicon">[docs]</a><span class="k">class</span> <span class="nc">Amplicon</span><span class="p">(</span><span class="n">Dseqrecord</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;The Amplicon class holds information about a PCR reaction involving two</span>
<span class="sd">    primers and one template. This class is used by the Anneal class and is not</span>
<span class="sd">    meant to be instantiated directly.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    forward_primer : SeqRecord(Biopython)</span>
<span class="sd">        SeqRecord object holding the forward (sense) primer</span>

<span class="sd">    reverse_primer : SeqRecord(Biopython)</span>
<span class="sd">        SeqRecord object holding the reverse (antisense) primer</span>

<span class="sd">    template : Dseqrecord</span>
<span class="sd">        Dseqrecord object holding the template (circular or linear)</span>

<span class="sd">    saltc : float, optional</span>
<span class="sd">        saltc = monovalent cations (mM) (Na,K..)</span>
<span class="sd">        default value is 50mM</span>
<span class="sd">        This is used for Tm calculations.</span>

<span class="sd">    forward_primer_concentration : float, optional</span>
<span class="sd">        primer concentration (nM)</span>
<span class="sd">        default set to 1000nM = 1µM</span>
<span class="sd">        This is used for Tm calculations.</span>

<span class="sd">    rc : float, optional</span>
<span class="sd">        primer concentration (nM)</span>
<span class="sd">        default set to 1000nM = 1µM</span>
<span class="sd">        This is used for Tm calculations.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>    <span class="bp">self</span><span class="p">,</span>
                     <span class="n">record</span><span class="p">,</span>
                     <span class="n">template</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                     <span class="n">forward_primer</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                     <span class="n">reverse_primer</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                     <span class="n">saltc</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                     <span class="n">forward_primer_concentration</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                     <span class="n">reverse_primer_concentration</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                     <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                     <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="c">#Dseqrecord.__init__(self,record,*args,**kwargs)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Amplicon</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="n">template</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forward_primer</span> <span class="o">=</span> <span class="n">forward_primer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reverse_primer</span> <span class="o">=</span> <span class="n">reverse_primer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fwd_primer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward_primer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rev_primer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_primer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forward_primer_concentration</span> <span class="o">=</span> <span class="n">forward_primer_concentration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reverse_primer_concentration</span> <span class="o">=</span> <span class="n">reverse_primer_concentration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saltc</span> <span class="o">=</span> <span class="n">saltc</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tmf</span> <span class="o">=</span> <span class="n">Tm_staluc</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">forward_primer</span><span class="o">.</span><span class="n">footprint</span><span class="p">),</span><span class="n">dnac</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">saltc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">saltc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmr</span> <span class="o">=</span> <span class="n">Tm_staluc</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse_primer</span><span class="o">.</span><span class="n">footprint</span><span class="p">),</span><span class="n">dnac</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">saltc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">saltc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmf_dbd</span> <span class="o">=</span> <span class="n">tmbresluc</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">forward_primer</span><span class="o">.</span><span class="n">footprint</span><span class="p">),</span><span class="n">primerc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">forward_primer_concentration</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmr_dbd</span> <span class="o">=</span> <span class="n">tmbresluc</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse_primer</span><span class="o">.</span><span class="n">footprint</span><span class="p">),</span><span class="n">primerc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse_primer_concentration</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sl</span><span class="p">):</span>
        <span class="n">answer</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">answer</span><span class="o">.</span><span class="n">seq</span> <span class="o">=</span> <span class="n">answer</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">__getitem__</span><span class="p">(</span><span class="n">sl</span><span class="p">)</span>
        <span class="n">answer</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">alphabet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">alphabet</span>
        <span class="n">sr</span> <span class="o">=</span> <span class="n">SeqRecord</span><span class="p">(</span><span class="s">&quot;n&quot;</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="n">sr</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span>
        <span class="n">answer</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="n">SeqRecord</span><span class="o">.</span><span class="n">__getitem__</span><span class="p">(</span><span class="n">sr</span><span class="p">,</span> <span class="n">sl</span><span class="p">)</span><span class="o">.</span><span class="n">features</span>
        <span class="k">return</span> <span class="n">answer</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;returns a short string representation of the object&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="s">&quot;Amplicon({})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__len__</span><span class="p">())</span>

<div class="viewcode-block" id="Amplicon.flankup"><a class="viewcode-back" href="../../pydna.html#pydna.amplify.Amplicon.flankup">[docs]</a>    <span class="k">def</span> <span class="nf">flankup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flankuplength</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Returns a Dseqrecord object containing flankuplength bases upstream of the forward primer footprint,</span>
<span class="sd">       Truncated if the template is not long enough.</span>

<span class="sd">       ::</span>

<span class="sd">        &lt;--- flankup ---&gt;</span>

<span class="sd">                  5TAATAAactactgactatct3</span>
<span class="sd">                         ||||||||||||||</span>
<span class="sd">        acgcattcagctactgtactactgactatctatcg</span>

<span class="sd">       &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">seq</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">forward_primer</span><span class="o">.</span><span class="n">position</span><span class="o">-</span><span class="n">flankuplength</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">forward_primer</span><span class="o">.</span><span class="n">footprint</span><span class="p">):</span><span class="bp">self</span><span class="o">.</span><span class="n">forward_primer</span><span class="o">.</span><span class="n">position</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">forward_primer</span><span class="o">.</span><span class="n">footprint</span><span class="p">)]</span>
</div>
<div class="viewcode-block" id="Amplicon.flankdn"><a class="viewcode-back" href="../../pydna.html#pydna.amplify.Amplicon.flankdn">[docs]</a>    <span class="k">def</span> <span class="nf">flankdn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flankdnlength</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Returns a Dseqrecord object containing flankdnlength bases downstream of the reverse primer footprint.</span>
<span class="sd">       Truncated if the template is not long enough.</span>

<span class="sd">       ::</span>

<span class="sd">                                       &lt;---- flankdn ------&gt;</span>

<span class="sd">                        3actactgactatctTAATAA5</span>
<span class="sd">                         ||||||||||||||</span>
<span class="sd">        acgcattcagctactgtactactgactatctatcgtacatgtactatcgtat</span>


<span class="sd">       &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">seq</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse_primer</span><span class="o">.</span><span class="n">position</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse_primer</span><span class="o">.</span><span class="n">footprint</span><span class="p">):</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse_primer</span><span class="o">.</span><span class="n">position</span><span class="o">+</span><span class="n">flankdnlength</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse_primer</span><span class="o">.</span><span class="n">footprint</span><span class="p">)]</span>


</div>
<div class="viewcode-block" id="Amplicon.figure"><a class="viewcode-back" href="../../pydna.html#pydna.amplify.Amplicon.figure">[docs]</a>    <span class="k">def</span> <span class="nf">figure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This method returns a simple figure of the two primers binding to a part</span>
<span class="sd">        of the template.</span>

<span class="sd">        ::</span>

<span class="sd">         5gctactacacacgtactgactg3</span>
<span class="sd">          |||||||||||||||||||||| tm 52.6 (dbd) 58.3</span>
<span class="sd">         5gctactacacacgtactgactg...caagatagagtcagtaaccaca3</span>
<span class="sd">         3cgatgatgtgtgcatgactgac...gttctatctcagtcattggtgt5</span>
<span class="sd">                                   |||||||||||||||||||||| tm 49.1 (dbd) 57.7</span>
<span class="sd">                                  3gttctatctcagtcattggtgt5</span>



<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        figure:string</span>
<span class="sd">             A string containing a text representation of the primers</span>
<span class="sd">             annealing on the template (see example above).</span>


<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        tm in the figure above is the melting temperature (tm) for each primer calculated according to</span>
<span class="sd">        SantaLucia 1998 [#]_.</span>

<span class="sd">        dbd is the tm calculation for enzymes with dsDNA binding domains like Pfu-Sso7d [#]_. See [#]_</span>
<span class="sd">        for more information.</span>

<span class="sd">        References</span>
<span class="sd">        ----------</span>

<span class="sd">        .. [#] J. SantaLucia, “A Unified View of Polymer, Dumbbell, and Oligonucleotide DNA Nearest-neighbor Thermodynamics,” Proceedings of the National Academy of Sciences 95, no. 4 (1998): 1460.</span>
<span class="sd">        .. [#] M. Nørholm, “A Mutant Pfu DNA Polymerprimerase Designed for Advanced Uracil-excision DNA Engineering,” BMC Biotechnology 10, no. 1 (2010): 21, doi:10.1186/1472-6750-10-21.</span>
<span class="sd">        .. [#] http://www.thermoscientificbio.com/webtools/tmc/</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">f</span> <span class="o">=</span>   <span class="s">&#39;&#39;&#39;</span>
<span class="s">            {sp1}5{faz}...{raz}3</span>
<span class="s">             {sp3}{rap} tm {tmr} (dbd) {tmr_dbd}</span>
<span class="s">            {sp3}3{rp}5</span>
<span class="s">            5{fp}3</span>
<span class="s">             {fap:&gt;{fplength}} tm {tmf} (dbd) {tmf_dbd}</span>
<span class="s">            {sp2}3{fzc}...{rzc}5</span>
<span class="s">            &#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">fp</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward_primer</span><span class="o">.</span><span class="n">seq</span><span class="p">,</span>
                        <span class="n">fap</span>      <span class="o">=</span> <span class="s">&quot;|&quot;</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">forward_primer</span><span class="o">.</span><span class="n">footprint</span><span class="p">),</span>
                        <span class="n">fplength</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">forward_primer</span><span class="o">.</span><span class="n">seq</span><span class="p">),</span>
                        <span class="n">tmf</span>      <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmf</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                        <span class="n">tmr</span>      <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmr</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                        <span class="n">tmf_dbd</span>  <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmf_dbd</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                        <span class="n">tmr_dbd</span>  <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmr_dbd</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                        <span class="n">rp</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_primer</span><span class="o">.</span><span class="n">seq</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                        <span class="n">rap</span>      <span class="o">=</span> <span class="s">&quot;|&quot;</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse_primer</span><span class="o">.</span><span class="n">footprint</span><span class="p">),</span>
                        <span class="n">rplength</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse_primer</span><span class="o">.</span><span class="n">seq</span><span class="p">),</span>
                        <span class="n">faz</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward_primer</span><span class="o">.</span><span class="n">footprint</span><span class="p">,</span>
                        <span class="n">raz</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_primer</span><span class="o">.</span><span class="n">footprint</span><span class="o">.</span><span class="n">reverse_complement</span><span class="p">(),</span>
                        <span class="n">fzc</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward_primer</span><span class="o">.</span><span class="n">footprint</span><span class="o">.</span><span class="n">complement</span><span class="p">(),</span>
                        <span class="n">rzc</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_primer</span><span class="o">.</span><span class="n">footprint</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                        <span class="n">sp1</span>      <span class="o">=</span> <span class="s">&quot; &quot;</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">forward_primer</span><span class="o">.</span><span class="n">seq</span><span class="p">)</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">forward_primer</span><span class="o">.</span><span class="n">footprint</span><span class="p">)),</span>
                        <span class="n">sp2</span>      <span class="o">=</span> <span class="s">&quot; &quot;</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">forward_primer</span><span class="o">.</span><span class="n">seq</span><span class="p">)</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">forward_primer</span><span class="o">.</span><span class="n">footprint</span><span class="p">)),</span>
                        <span class="n">sp3</span>      <span class="o">=</span> <span class="s">&quot; &quot;</span><span class="o">*</span><span class="p">(</span><span class="mi">3</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">forward_primer</span><span class="o">.</span><span class="n">seq</span><span class="p">))</span>
                       <span class="p">)</span>
        <span class="k">return</span> <span class="n">pretty_str</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Amplicon.program"><a class="viewcode-back" href="../../pydna.html#pydna.amplify.Amplicon.program">[docs]</a>    <span class="k">def</span> <span class="nf">program</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Returns a string containing a text representation of a proposed</span>
<span class="sd">       PCR program using Taq or similar polymerase.</span>

<span class="sd">       ::</span>

<span class="sd">        Taq (rate 30 nt/s)</span>
<span class="sd">        Three-step|         30 cycles     |      |SantaLucia 1998</span>
<span class="sd">        94.0°C    |94.0°C                 |      |SaltC 50mM</span>
<span class="sd">        __________|_____          72.0°C  |72.0°C|</span>
<span class="sd">        04min00s  |30s  \         ________|______|</span>
<span class="sd">                  |      \ 46.0°C/ 0min 1s|10min |</span>
<span class="sd">                  |       \_____/         |      |</span>
<span class="sd">                  |         30s           |      |4-8°C</span>

<span class="sd">       &#39;&#39;&#39;</span>

        <span class="c"># Ta calculation according to</span>
        <span class="c"># Rychlik, Spencer, and Rhoads, 1990, Optimization of the anneal</span>
        <span class="c"># ing temperature for DNA amplification in vitro</span>
        <span class="c"># http://www.ncbi.nlm.nih.gov/pubmed/2003928</span>
        <span class="n">GC_prod</span><span class="o">=</span><span class="n">GC</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">))</span>
        <span class="n">tml</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmf</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">tmr</span><span class="p">)</span>
        <span class="c">#print GC(str(self.product.seq)), self.saltc/1000.0, len(self.product)</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="mf">81.5</span> <span class="o">+</span> <span class="mf">0.41</span><span class="o">*</span><span class="n">GC</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">))</span> <span class="o">+</span> <span class="mf">16.6</span><span class="o">*</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saltc</span><span class="o">/</span><span class="mf">1000.0</span><span class="p">)</span> <span class="o">-</span> <span class="mi">675</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">ta</span> <span class="o">=</span> <span class="mf">0.3</span><span class="o">*</span><span class="n">tml</span><span class="o">+</span><span class="mf">0.7</span><span class="o">*</span><span class="n">tmp</span><span class="o">-</span><span class="mf">14.9</span>
        <span class="c"># Fermentas recombinant taq</span>
        <span class="n">taq_extension_rate</span> <span class="o">=</span> <span class="mi">30</span>  <span class="c"># seconds/kB PCR product length</span>
        <span class="n">extension_time_taq</span> <span class="o">=</span> <span class="n">taq_extension_rate</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span> <span class="c"># seconds</span>
        <span class="n">f</span>  <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s">u&#39;&#39;&#39;</span>
<span class="s">                                 Taq (rate {rate} nt/s) 35 cycles             |{size}bp</span>
<span class="s">                                 95.0°C    |95.0°C                 |      |SantaLucia 1998</span>
<span class="s">                                 |_________|_____          72.0°C  |72.0°C|SaltC {saltc:2}mM</span>
<span class="s">                                 | 03min00s|30s  \         ________|______|</span>
<span class="s">                                 |         |      \ {ta}°C/{0:2}min{1:2}s| 5min |</span>
<span class="s">                                 |         |       \_____/         |      |</span>
<span class="s">                                 |         |         30s           |      |4-12°C&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rate</span>      <span class="o">=</span> <span class="n">taq_extension_rate</span><span class="p">,</span>
                                           <span class="n">ta</span>      <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">ta</span><span class="p">),</span>
                                           <span class="n">saltc</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">saltc</span><span class="p">,</span>
                                            <span class="o">*</span><span class="nb">divmod</span><span class="p">(</span><span class="n">extension_time_taq</span><span class="p">,</span><span class="mi">60</span><span class="p">),</span>
                                            <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">pretty_str</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Amplicon.taq_program"><a class="viewcode-back" href="../../pydna.html#pydna.amplify.Amplicon.taq_program">[docs]</a>    <span class="k">def</span> <span class="nf">taq_program</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">program</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Amplicon.dbd_program"><a class="viewcode-back" href="../../pydna.html#pydna.amplify.Amplicon.dbd_program">[docs]</a>    <span class="k">def</span> <span class="nf">dbd_program</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Returns a string containing a text representation of a proposed</span>
<span class="sd">       PCR program using a polymerase with a DNA binding domain such as Pfu-Sso7d.</span>

<span class="sd">       ::</span>

<span class="sd">        Pfu-Sso7d (rate 15s/kb)</span>
<span class="sd">        Three-step|          30 cycles   |      |Breslauer1986,SantaLucia1998</span>
<span class="sd">        98.0°C    |98.0°C                |      |SaltC 50mM</span>
<span class="sd">        __________|_____          72.0°C |72.0°C|Primer1C   1µM</span>
<span class="sd">        00min30s  |10s  \ 61.0°C ________|______|Primer2C   1µM</span>
<span class="sd">                  |      \______/ 0min 0s|10min |</span>
<span class="sd">                  |        10s           |      |4-8°C</span>

<span class="sd">       &#39;&#39;&#39;</span>
        <span class="n">PfuSso7d_extension_rate</span> <span class="o">=</span> <span class="mi">15</span> <span class="c">#seconds/kB PCR product</span>
        <span class="n">extension_time_PfuSso7d</span> <span class="o">=</span> <span class="n">PfuSso7d_extension_rate</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span>  <span class="c"># seconds</span>

        <span class="c"># Ta calculation for enzymes with dsDNA binding domains like Pfu-Sso7d</span>
        <span class="c"># https://www.finnzymes.fi/tm_determination.html</span>

        <span class="n">length_of_f</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">forward_primer</span><span class="o">.</span><span class="n">footprint</span><span class="p">)</span>
        <span class="n">length_of_r</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse_primer</span><span class="o">.</span><span class="n">footprint</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">length_of_f</span><span class="o">&gt;</span><span class="mi">20</span> <span class="ow">and</span> <span class="n">length_of_r</span><span class="o">&gt;</span><span class="mi">20</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmf_dbd</span><span class="o">&gt;=</span><span class="mf">69.0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmr_dbd</span><span class="o">&gt;=</span><span class="mf">69.0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmf_dbd</span><span class="o">&gt;=</span><span class="mf">72.0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmr_dbd</span><span class="o">&gt;=</span><span class="mf">72.0</span><span class="p">):</span>
            <span class="n">f</span><span class="o">=</span><span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span>  <span class="s">&#39;&#39;&#39;</span>
<span class="s">                                    Pfu-Sso7d (rate {rate}s/kb)</span>
<span class="s">                                    Two-step|    30 cycles |      |{size}bp</span>
<span class="s">                                    98.0°C  |98.0C         |      |Breslauer1986,SantaLucia1998</span>
<span class="s">                                    _____ __|_____         |      |SaltC {saltc:2}mM</span>
<span class="s">                                    00min30s|10s  \  72.0°C|72.0°C|Primer1C {forward_primer_concentration:3}µM</span>
<span class="s">                                            |      \_______|______|Primer2C {reverse_primer_concentration:3}µM</span>
<span class="s">                                            |      {0:2}min{1:2}s|10min |4-8°C</span>
<span class="s">                                 &#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rate</span> <span class="o">=</span> <span class="n">PfuSso7d_extension_rate</span><span class="p">,</span>
                                            <span class="n">forward_primer_concentration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward_primer_concentration</span><span class="p">,</span>
                                            <span class="n">reverse_primer_concentration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rc</span><span class="p">,</span>
                                            <span class="n">saltc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">saltc</span><span class="p">,</span>
                                            <span class="o">*</span><span class="nb">divmod</span><span class="p">(</span><span class="n">extension_time_PfuSso7d</span><span class="p">,</span><span class="mi">60</span><span class="p">),</span>
                                            <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">length_of_f</span><span class="o">&gt;</span><span class="mi">20</span> <span class="ow">and</span> <span class="n">length_of_r</span><span class="o">&gt;</span><span class="mi">20</span><span class="p">):</span>
                <span class="n">ta</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmf_dbd</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">tmr_dbd</span><span class="p">)</span><span class="o">+</span><span class="mi">3</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ta</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmf_dbd</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">tmr_dbd</span><span class="p">)</span>

            <span class="n">f</span><span class="o">=</span><span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span>  <span class="s">&#39;&#39;&#39;</span>
<span class="s">                                    Pfu-Sso7d (rate {rate}s/kb)</span>
<span class="s">                                    Three-step|          30 cycles   |      |Breslauer1986,SantaLucia1998</span>
<span class="s">                                    98.0°C    |98.0°C                |      |SaltC {saltc:2}mM</span>
<span class="s">                                    __________|_____          72.0°C |72.0°C|Primer1C {forward_primer_concentration:3}µM</span>
<span class="s">                                    00min30s  |10s  \ {ta}°C ________|______|Primer2C {reverse_primer_concentration:3}µM</span>
<span class="s">                                              |      \______/{0:2}min{1:2}s|10min |</span>
<span class="s">                                              |        10s           |      |4-8°C</span>
<span class="s">                                 &#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rate</span> <span class="o">=</span> <span class="n">PfuSso7d_extension_rate</span><span class="p">,</span>
                                            <span class="n">ta</span>   <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">ta</span><span class="p">),</span>
                                            <span class="n">forward_primer_concentration</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward_primer_concentration</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span>
                                            <span class="n">reverse_primer_concentration</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_primer_concentration</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span>
                                            <span class="n">saltc</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">saltc</span><span class="p">,</span>
                                            <span class="o">*</span><span class="nb">divmod</span><span class="p">(</span><span class="n">extension_time_PfuSso7d</span><span class="p">,</span><span class="mi">60</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">pretty_str</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>


</div></div>
<div class="viewcode-block" id="Anneal"><a class="viewcode-back" href="../../pydna.html#pydna.amplify.Anneal">[docs]</a><span class="k">class</span> <span class="nc">Anneal</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">u&#39;&#39;&#39;</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    primers : iterable containing SeqRecord objects</span>
<span class="sd">        Primer sequences 5&#39;-3&#39;.</span>

<span class="sd">    template : Dseqrecord object</span>
<span class="sd">        The template sequence 5&#39;-3&#39;.</span>

<span class="sd">    limit : int, optional</span>
<span class="sd">        limit length of the annealing part of the primers.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    products: list</span>
<span class="sd">        A list of Amplicon objects, one for each primer pair that may form a PCR product.</span>


<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import pydna</span>
<span class="sd">    &gt;&gt;&gt; template = pydna.Dseqrecord(&quot;tacactcaccgtctatcattatctactatcgactgtatcatctgatagcac&quot;)</span>
<span class="sd">    &gt;&gt;&gt; from Bio.SeqRecord import SeqRecord</span>
<span class="sd">    &gt;&gt;&gt; p1 = pydna.read(&quot;&gt;p1\\ntacactcaccgtctatcattatc&quot;, ds = False)</span>
<span class="sd">    &gt;&gt;&gt; p2 = pydna.read(&quot;&gt;p2\\ngtgctatcagatgatacagtcg&quot;, ds = False)</span>
<span class="sd">    &gt;&gt;&gt; ann = pydna.Anneal((p1, p2), template)</span>
<span class="sd">    &gt;&gt;&gt; print ann.report()</span>
<span class="sd">    Template &lt;unknown name&gt; 51 nt linear:</span>
<span class="sd">    Primer p1 anneals forward at position 23</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    Primer p2 anneals reverse at position 29</span>
<span class="sd">    &gt;&gt;&gt; ann.products</span>
<span class="sd">    [Amplicon(51)]</span>
<span class="sd">    &gt;&gt;&gt; amplicon_list = ann.products</span>
<span class="sd">    &gt;&gt;&gt; amplicon = amplicon_list.pop()</span>
<span class="sd">    &gt;&gt;&gt; amplicon</span>
<span class="sd">    Amplicon(51)</span>
<span class="sd">    &gt;&gt;&gt; print amplicon.figure()</span>
<span class="sd">    5tacactcaccgtctatcattatc...cgactgtatcatctgatagcac3</span>
<span class="sd">                               |||||||||||||||||||||| tm 50.6 (dbd) 60.5</span>
<span class="sd">                              3gctgacatagtagactatcgtg5</span>
<span class="sd">    5tacactcaccgtctatcattatc3</span>
<span class="sd">     ||||||||||||||||||||||| tm 49.4 (dbd) 58.8</span>
<span class="sd">    3atgtgagtggcagatagtaatag...gctgacatagtagactatcgtg5</span>
<span class="sd">    &gt;&gt;&gt; amplicon.annotations[&#39;date&#39;] = &#39;02-FEB-2013&#39;   # Set the date for this example to pass the doctest</span>
<span class="sd">    &gt;&gt;&gt; print amplicon</span>
<span class="sd">    Dseqrecord</span>
<span class="sd">    circular: False</span>
<span class="sd">    size: 51</span>
<span class="sd">    ID: 51bp U96+TO06Y6pFs74SQx8M1IVTBiY</span>
<span class="sd">    Name: 51bp_PCR_prod</span>
<span class="sd">    Description: Product_p1_p2</span>
<span class="sd">    Number of features: 4</span>
<span class="sd">    /date=02-FEB-2013</span>
<span class="sd">    Dseq(-51)</span>
<span class="sd">    taca..gcac</span>
<span class="sd">    atgt..cgtg</span>
<span class="sd">    &gt;&gt;&gt; print amplicon.program()</span>
<span class="sd">    &lt;BLANKLINE&gt;</span>
<span class="sd">    Taq (rate 30 nt/s) 35 cycles             |51bp</span>
<span class="sd">    95.0°C    |95.0°C                 |      |SantaLucia 1998</span>
<span class="sd">    |_________|_____          72.0°C  |72.0°C|SaltC 50mM</span>
<span class="sd">    | 03min00s|30s  \         ________|______|</span>
<span class="sd">    |         |      \ 44.0°C/ 0min 1s| 5min |</span>
<span class="sd">    |         |       \_____/         |      |</span>
<span class="sd">    |         |         30s           |      |4-12°C</span>
<span class="sd">    &gt;&gt;&gt;</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span>
                  <span class="n">primers</span><span class="p">,</span>
                  <span class="n">template</span><span class="p">,</span>
                  <span class="n">limit</span><span class="o">=</span><span class="mi">13</span><span class="p">):</span>

        <span class="n">key</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">template</span><span class="o">.</span><span class="n">seguid</span><span class="p">())</span> <span class="o">+</span> <span class="s">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">([</span><span class="n">seguid</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">seq</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">primers</span><span class="p">]))</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">limit</span><span class="p">)</span>
        <span class="n">cache</span> <span class="o">=</span> <span class="n">shelve</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&quot;datadir&quot;</span><span class="p">],</span> <span class="s">&quot;amplify.shelf&quot;</span><span class="p">),</span> <span class="n">protocol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">writeback</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

        <span class="n">refresh</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">cached</span>  <span class="o">=</span> <span class="bp">None</span>

        <span class="n">primers</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">primers</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">seq</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&quot;pydna_cache&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;compare&quot;</span><span class="p">,</span> <span class="s">&quot;cached&quot;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cached</span> <span class="o">=</span> <span class="n">cache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&quot;pydna_cache&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;compare&quot;</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;no result for this key!&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">refresh</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="k">if</span> <span class="n">refresh</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&quot;pydna_cache&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;compare&quot;</span><span class="p">,</span> <span class="s">&quot;refresh&quot;</span><span class="p">,</span> <span class="s">&quot;nocache&quot;</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
            <span class="c">#self.template.features = copy.deepcopy(template.features)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">limit</span> <span class="o">=</span> <span class="n">limit</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_products</span> <span class="o">=</span> <span class="bp">None</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">fwd_primers</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rev_primers</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">twl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">watson</span><span class="p">)</span>
            <span class="n">tcl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">crick</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">linear</span><span class="p">:</span>
                <span class="n">tw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">watson</span>
                <span class="n">tc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">crick</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">watson</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">watson</span>
                <span class="n">tc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">crick</span> <span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">crick</span>

            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">primers</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fwd_primers</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">Primer</span><span class="p">(</span><span class="n">p</span><span class="p">,</span>
                                                <span class="n">tcl</span><span class="o">-</span><span class="n">pos</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">ovhg</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                                                <span class="n">Seq</span><span class="p">(</span><span class="n">fp</span><span class="p">),</span> <span class="n">Seq</span><span class="p">(</span><span class="n">tl</span><span class="p">))</span>
                                        <span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">tl</span> <span class="ow">in</span> <span class="n">_annealing_positions</span><span class="p">(</span>
                                                            <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">seq</span><span class="p">),</span>
                                                            <span class="n">tc</span><span class="p">,</span>
                                                            <span class="n">limit</span><span class="p">)</span> <span class="k">if</span> <span class="n">pos</span><span class="o">&lt;</span><span class="n">tcl</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rev_primers</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">Primer</span><span class="p">(</span><span class="n">p</span><span class="p">,</span>
                                                <span class="n">pos</span> <span class="o">+</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">ovhg</span><span class="p">),</span>
                                                <span class="n">Seq</span><span class="p">(</span><span class="n">fp</span><span class="p">),</span> <span class="n">Seq</span><span class="p">(</span><span class="n">tl</span><span class="p">))</span>
                                         <span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">tl</span> <span class="ow">in</span> <span class="n">_annealing_positions</span><span class="p">(</span>
                                                                         <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">seq</span><span class="p">),</span>
                                                                         <span class="n">tw</span><span class="p">,</span>
                                                                         <span class="n">limit</span><span class="p">)</span> <span class="k">if</span> <span class="n">pos</span><span class="o">&lt;</span><span class="n">twl</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fwd_primers</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">attrgetter</span><span class="p">(</span><span class="s">&#39;position&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rev_primers</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">attrgetter</span><span class="p">(</span><span class="s">&#39;position&#39;</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">fp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fwd_primers</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">fp</span><span class="o">.</span><span class="n">position</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">footprint</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">position</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">footprint</span><span class="p">)</span>
                    <span class="n">end</span>   <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">position</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SeqFeature</span><span class="p">(</span><span class="n">FeatureLocation</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">),</span>
                                                        <span class="nb">type</span> <span class="o">=</span><span class="s">&quot;primer_bind&quot;</span><span class="p">,</span>
                                                        <span class="n">strand</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                                                        <span class="n">qualifiers</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;note&quot;</span><span class="p">:[</span><span class="n">fp</span><span class="o">.</span><span class="n">name</span><span class="p">],</span>
                                                                      <span class="s">&quot;ApEinfo_fwdcolor&quot;</span><span class="p">:[</span><span class="s">&quot;green&quot;</span><span class="p">],</span>
                                                                      <span class="s">&quot;ApEinfo_revcolor&quot;</span><span class="p">:[</span><span class="s">&quot;red&quot;</span><span class="p">]}))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="p">)</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">footprint</span><span class="p">)</span><span class="o">+</span><span class="n">fp</span><span class="o">.</span><span class="n">position</span>
                    <span class="n">end</span> <span class="o">=</span> <span class="n">start</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">footprint</span><span class="p">)</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="p">)</span>
                    <span class="n">sf</span><span class="o">=</span><span class="n">SeqFeature</span><span class="p">(</span><span class="n">CompoundLocation</span><span class="p">([</span><span class="n">FeatureLocation</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="p">)),</span>
                                                    <span class="n">FeatureLocation</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="p">)]),</span>
                                                    <span class="nb">type</span><span class="o">=</span><span class="s">&quot;primer_bind&quot;</span><span class="p">,</span>
                                                    <span class="n">location_operator</span><span class="o">=</span><span class="s">&quot;join&quot;</span><span class="p">,</span>
                                                    <span class="n">qualifiers</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;note&quot;</span><span class="p">:[</span><span class="n">fp</span><span class="o">.</span><span class="n">name</span><span class="p">]})</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sf</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">rp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rev_primers</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">rp</span><span class="o">.</span><span class="n">position</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">footprint</span><span class="p">)</span><span class="o">&lt;=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="p">):</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">rp</span><span class="o">.</span><span class="n">position</span>
                    <span class="n">end</span>   <span class="o">=</span> <span class="n">rp</span><span class="o">.</span><span class="n">position</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">footprint</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SeqFeature</span><span class="p">(</span><span class="n">FeatureLocation</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">end</span><span class="p">),</span>
                                                        <span class="nb">type</span> <span class="o">=</span><span class="s">&quot;primer_bind&quot;</span><span class="p">,</span>
                                                        <span class="n">strand</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                                        <span class="n">qualifiers</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;note&quot;</span><span class="p">:[</span><span class="n">rp</span><span class="o">.</span><span class="n">name</span><span class="p">],</span>
                                                                      <span class="s">&quot;ApEinfo_fwdcolor&quot;</span><span class="p">:[</span><span class="s">&quot;green&quot;</span><span class="p">],</span>
                                                                      <span class="s">&quot;ApEinfo_revcolor&quot;</span><span class="p">:[</span><span class="s">&quot;red&quot;</span><span class="p">]}))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">rp</span><span class="o">.</span><span class="n">position</span>
                    <span class="n">end</span> <span class="o">=</span> <span class="n">rp</span><span class="o">.</span><span class="n">position</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">footprint</span><span class="p">)</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SeqFeature</span><span class="p">(</span><span class="n">CompoundLocation</span><span class="p">([</span><span class="n">FeatureLocation</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="p">)),</span>
                                                                               <span class="n">FeatureLocation</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">end</span><span class="p">)]),</span>
                                                        <span class="nb">type</span> <span class="o">=</span><span class="s">&quot;primer_bind&quot;</span><span class="p">,</span>
                                                        <span class="n">location_operator</span><span class="o">=</span> <span class="s">&quot;join&quot;</span><span class="p">,</span>
                                                        <span class="n">strand</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                                        <span class="n">qualifiers</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;note&quot;</span><span class="p">:[</span><span class="n">rp</span><span class="o">.</span><span class="n">name</span><span class="p">]}))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">forward_primers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fwd_primers</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reverse_primers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rev_primers</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&quot;pydna_cache&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;compare&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_compare</span><span class="p">(</span><span class="n">cached</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">refresh</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&quot;pydna_cache&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;refresh&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">cached</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&quot;pydna_cache&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;nocache&quot;</span><span class="p">,</span><span class="s">&quot;refresh&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">cached</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>
        <span class="n">cache</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_compare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cached</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cached</span><span class="p">):</span>
            <span class="n">module_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&#39;amplify error&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cache</span> <span class="o">=</span> <span class="n">shelve</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&quot;datadir&quot;</span><span class="p">],</span> <span class="s">&quot;amplify.shelf&quot;</span><span class="p">),</span> <span class="n">protocol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">writeback</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">cache</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">cache</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="Anneal.products"><a class="viewcode-back" href="../../pydna.html#pydna.amplify.Anneal.products">[docs]</a>    <span class="k">def</span> <span class="nf">products</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_products</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_products</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_products</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">fp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fwd_primers</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">rp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rev_primers</span><span class="p">:</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">circular</span> <span class="ow">and</span> <span class="n">fp</span><span class="o">.</span><span class="n">position</span><span class="o">&gt;</span><span class="n">rp</span><span class="o">.</span><span class="n">position</span><span class="p">:</span>
                    <span class="n">tmpl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">shifted</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">position</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">footprint</span><span class="p">))</span>
                    <span class="n">tmpl</span> <span class="o">=</span> <span class="n">tmpl</span><span class="o">.</span><span class="n">_multiply_circular</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                    <span class="n">tmpl</span> <span class="o">=</span> <span class="n">tmpl</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">position</span> <span class="o">-</span> <span class="n">rp</span><span class="o">.</span><span class="n">position</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">footprint</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">footprint</span><span class="p">)]</span>
                    <span class="c">#print len(self.template) - (fp.position - rp.position) + len(rp.footprint) + len(fp.footprint)</span>
                    <span class="c">#print len(tmpl)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">circular</span><span class="p">:</span>
                    <span class="n">tmpl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">_multiply_circular</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                    <span class="n">tmpl</span> <span class="o">=</span> <span class="n">tmpl</span><span class="p">[</span><span class="n">fp</span><span class="o">.</span><span class="n">position</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">footprint</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="p">):</span><span class="n">rp</span><span class="o">.</span><span class="n">position</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">footprint</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="p">)]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tmpl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="p">[</span><span class="n">fp</span><span class="o">.</span><span class="n">position</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">footprint</span><span class="p">):</span><span class="n">rp</span><span class="o">.</span><span class="n">position</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">footprint</span><span class="p">)]</span>

                <span class="n">prd</span> <span class="o">=</span> <span class="p">(</span> <span class="n">Dseqrecord</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">tail</span><span class="p">)</span> <span class="o">+</span> <span class="n">tmpl</span> <span class="o">+</span> <span class="n">Dseqrecord</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">tail</span><span class="p">)</span><span class="o">.</span><span class="n">reverse_complement</span><span class="p">())</span>

                <span class="n">prd</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">fp</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="n">fp</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                <span class="n">prd</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">prd</span><span class="p">)</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">prd</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="n">rp</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">strand</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

                <span class="c">#prd.seq = fp.seq+tmpl.seq[len(fp.footprint):len(tmpl)-len(rp.footprint)]+rp.seq.reverse_complement()</span>

                <span class="c">#features = tmpl[fp.position-len(fp.footprint):rp.position+len(rp.footprint)].features</span>
                <span class="c">#print   fp.position-len(fp.footprint), rp.position+len(rp.footprint), features</span>
                <span class="c">#print &quot;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&quot;,features</span>
                <span class="c">#prd.features = [f._shift(len(fp.tail)) for f in features]</span>
                <span class="c"># description = Genbank LOCUS max 16 chars</span>

                <span class="n">prd</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;{0}bp_PCR_prod&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">prd</span><span class="p">))[:</span><span class="mi">16</span><span class="p">]</span>
                <span class="n">prd</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="s">&quot;{0}bp {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">prd</span><span class="p">))[:</span><span class="mi">14</span><span class="p">],</span> <span class="n">prd</span><span class="o">.</span><span class="n">seguid</span><span class="p">()</span> <span class="p">)</span>
                <span class="n">prd</span><span class="o">.</span><span class="n">description</span><span class="o">=</span><span class="s">&quot;Product_{0}_{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">fp</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
                                                          <span class="n">rp</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_products</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">Amplicon</span><span class="p">(</span><span class="n">prd</span><span class="p">,</span>
                                                <span class="n">template</span><span class="o">=</span><span class="n">tmpl</span><span class="p">,</span>
                                                <span class="n">forward_primer</span><span class="o">=</span><span class="n">fp</span><span class="p">,</span>
                                                <span class="n">reverse_primer</span><span class="o">=</span><span class="n">rp</span><span class="p">,</span>
                                                <span class="n">saltc</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                                                <span class="n">forward_primer_concentration</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
                                                <span class="n">reverse_primer_concentration</span><span class="o">=</span><span class="mi">1000</span><span class="p">))</span>
                <span class="k">assert</span> <span class="s">&quot; &quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">prd</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">watson</span><span class="p">)</span>
                <span class="k">assert</span> <span class="s">&quot; &quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">prd</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">crick</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_products</span>


</div>
<div class="viewcode-block" id="Anneal.report"><a class="viewcode-back" href="../../pydna.html#pydna.amplify.Anneal.report">[docs]</a>    <span class="k">def</span> <span class="nf">report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;This method is an alias of str(Annealobj).</span>
<span class="sd">        Returns a short string representation.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__str__</span><span class="p">()</span>
</div>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; returns a short string representation &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="s">&quot;Reaction(products = {})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fwd_primers</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rev_primers</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;returns a short report describing if or where primer</span>
<span class="sd">       anneal on the template.</span>
<span class="sd">       &#39;&#39;&#39;</span>
        <span class="n">mystring</span> <span class="o">=</span> <span class="s">&quot;Template {name} {size} nt {top}:</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                                               <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="p">),</span>
                                                               <span class="n">top</span><span class="o">=</span><span class="p">{</span><span class="bp">True</span><span class="p">:</span><span class="s">&quot;circular&quot;</span><span class="p">,</span>
                                                                    <span class="bp">False</span><span class="p">:</span><span class="s">&quot;linear&quot;</span><span class="p">}[</span><span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">circular</span><span class="p">]</span>
                                                                    <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fwd_primers</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fwd_primers</span><span class="p">:</span>
                <span class="n">mystring</span> <span class="o">+=</span> <span class="s">&quot;Primer {name} anneals forward at position {pos}</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mystring</span> <span class="o">+=</span> <span class="s">&quot;No forward primers anneal...</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="n">mystring</span> <span class="o">+=</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rev_primers</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rev_primers</span><span class="p">:</span>
                <span class="n">mystring</span> <span class="o">+=</span> <span class="s">&quot;Primer {name} anneals reverse at position {pos}</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
             <span class="n">mystring</span> <span class="o">+=</span> <span class="s">&quot;No reverse primers anneal...</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="k">return</span> <span class="n">mystring</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>





</div>
<div class="viewcode-block" id="pcr"><a class="viewcode-back" href="../../pydna.html#pydna.amplify.pcr">[docs]</a><span class="k">def</span> <span class="nf">pcr</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span>  <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;pcr is a convenience function for Anneal to simplify its usage,</span>
<span class="sd">    especially from the command line. If more than one PCR product is</span>
<span class="sd">    formed, an exception is raised.</span>

<span class="sd">    args is any iterable of sequences or an iterable of iterables of sequences.</span>
<span class="sd">    args will be greedily flattened.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    args : iterable containing sequence objects</span>
<span class="sd">        Several arguments are also accepted.</span>

<span class="sd">    limit : int = 13, optional</span>
<span class="sd">        limit length of the annealing part of the primers.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    sequences in args could be of type:</span>

<span class="sd">    * string</span>
<span class="sd">    * Seq</span>
<span class="sd">    * SeqRecord</span>
<span class="sd">    * Dseqrecord</span>

<span class="sd">    The last sequence will be interpreted as the template</span>
<span class="sd">    all preceeding sequences as primers.</span>

<span class="sd">    This is a powerful function, use with care!</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    product : Dseqrecord</span>
<span class="sd">        a Dseqrecord object representing the PCR product.</span>
<span class="sd">        The direction of the PCR product will be the same as</span>
<span class="sd">        for the template sequence.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; import pydna</span>
<span class="sd">    &gt;&gt;&gt; template = pydna.Dseqrecord(&quot;tacactcaccgtctatcattatctactatcgactgtatcatctgatagcac&quot;)</span>
<span class="sd">    &gt;&gt;&gt; from Bio.SeqRecord import SeqRecord</span>
<span class="sd">    &gt;&gt;&gt; p1 = pydna.read(&quot;&gt;p1\\ntacactcaccgtctatcattatc&quot;, ds = False)</span>
<span class="sd">    &gt;&gt;&gt; p2 = pydna.read(&quot;&gt;p2\\ncgactgtatcatctgatagcac&quot;, ds = False).reverse_complement()</span>
<span class="sd">    &gt;&gt;&gt; pydna.pcr(p1, p2, template)</span>
<span class="sd">    Amplicon(51)</span>
<span class="sd">    &gt;&gt;&gt; pydna.pcr([p1, p2], template)</span>
<span class="sd">    Amplicon(51)</span>
<span class="sd">    &gt;&gt;&gt; pydna.pcr((p1,p2,), template)</span>
<span class="sd">    Amplicon(51)</span>
<span class="sd">    &gt;&gt;&gt;</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="kn">from</span> <span class="nn">Bio.SeqRecord</span> <span class="kn">import</span> <span class="n">SeqRecord</span>
    <span class="c"># flatten args</span>
    <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">stack</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">stack</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
    <span class="k">while</span> <span class="n">stack</span><span class="p">:</span>
        <span class="n">top</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">top</span><span class="p">,</span> <span class="s">&quot;__iter__&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">top</span><span class="p">,</span> <span class="n">SeqRecord</span><span class="p">):</span>
            <span class="n">stack</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">top</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>
    <span class="n">new</span><span class="o">=</span><span class="p">[]</span>

    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">output</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">Seq</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">SeqRecord</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">SeqRecord</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">&quot;watson&quot;</span><span class="p">):</span>
            <span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">watson</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">SeqRecord</span><span class="p">(</span><span class="n">Seq</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;the record property needs to be a string, a Seq object or a SeqRecord object&quot;</span><span class="p">)</span>
        <span class="n">new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

    <span class="n">anneal_primers</span> <span class="o">=</span> <span class="n">Anneal</span><span class="p">(</span>  <span class="n">new</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                              <span class="n">new</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                              <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">anneal_primers</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">anneal_primers</span><span class="o">.</span><span class="n">products</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">anneal_primers</span><span class="o">.</span><span class="n">products</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">anneal_primers</span><span class="o">.</span><span class="n">products</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;No PCR products! {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">anneal_primers</span><span class="o">.</span><span class="n">report</span><span class="p">()))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;PCR not specific! {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">anneal_primers</span><span class="o">.</span><span class="n">report</span><span class="p">()))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">anneal_primers</span><span class="o">.</span><span class="n">report</span><span class="p">())</span>
    <span class="k">return</span>

</div>
<div class="viewcode-block" id="nopcr"><a class="viewcode-back" href="../../pydna.html#pydna.amplify.nopcr">[docs]</a><span class="k">def</span> <span class="nf">nopcr</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span>  <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;pcr is a convenience function for Anneal to simplify its usage,</span>
<span class="sd">    especially from the command line. If more one or more PCR products are</span>
<span class="sd">    formed, an exception is raised.</span>

<span class="sd">    args is any iterable of sequences or an iterable of iterables of sequences.</span>
<span class="sd">    args will be greedily flattened.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    args : iterable containing sequence objects</span>
<span class="sd">        Several arguments are also accepted.</span>

<span class="sd">    limit : int = 13, optional</span>
<span class="sd">        limit length of the annealing part of the primers.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    sequences in args could be of type:</span>

<span class="sd">    * string</span>
<span class="sd">    * Seq</span>
<span class="sd">    * SeqRecord</span>
<span class="sd">    * Dseqrecord</span>

<span class="sd">    The last sequence will be interpreted as the template</span>
<span class="sd">    all preceeding sequences as primers.</span>

<span class="sd">    This is a powerful function, use with care!</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    product : Dseqrecord</span>
<span class="sd">        a Dseqrecord object representing the PCR product.</span>
<span class="sd">        The direction of the PCR product will be the same as</span>
<span class="sd">        for the template sequence.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; import pydna</span>
<span class="sd">    &gt;&gt;&gt; template = pydna.Dseqrecord(&quot;tacactcaccgtctatcattatctactatcgactgtatcatctgatagcac&quot;)</span>
<span class="sd">    &gt;&gt;&gt; from Bio.SeqRecord import SeqRecord</span>
<span class="sd">    &gt;&gt;&gt; from Bio.Seq import Seq</span>
<span class="sd">    &gt;&gt;&gt; p1 = SeqRecord(Seq(&quot;tacactcaccgtctatcattatc&quot;))</span>
<span class="sd">    &gt;&gt;&gt; p2 = SeqRecord(Seq(&quot;gtgctatcagatgatacagtG&quot;)) # This primer does not anneal</span>
<span class="sd">    &gt;&gt;&gt; pydna.nopcr(p1, p2, template)</span>
<span class="sd">    True</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="kn">from</span> <span class="nn">Bio.SeqRecord</span> <span class="kn">import</span> <span class="n">SeqRecord</span>
    <span class="c"># flatten args</span>
    <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">stack</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">stack</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
    <span class="k">while</span> <span class="n">stack</span><span class="p">:</span>
        <span class="n">top</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">top</span><span class="p">,</span> <span class="s">&quot;__iter__&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">top</span><span class="p">,</span> <span class="n">SeqRecord</span><span class="p">):</span>
            <span class="n">stack</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">top</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>
    <span class="n">new</span><span class="o">=</span><span class="p">[]</span>

    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">output</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">Seq</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">SeqRecord</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">SeqRecord</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">&quot;watson&quot;</span><span class="p">):</span>
            <span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">watson</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">SeqRecord</span><span class="p">(</span><span class="n">Seq</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;the record property needs to be a string, a Seq object or a SeqRecord object&quot;</span><span class="p">)</span>
        <span class="n">new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

    <span class="n">anneal_primers</span> <span class="o">=</span> <span class="n">Anneal</span><span class="p">(</span>  <span class="n">new</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                              <span class="n">new</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                              <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">anneal_primers</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">anneal_primers</span><span class="o">.</span><span class="n">products</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;PCR products formed! {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">anneal_primers</span><span class="o">.</span><span class="n">report</span><span class="p">()))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">anneal_primers</span><span class="o">.</span><span class="n">report</span><span class="p">())</span>
    <span class="k">return</span> <span class="bp">True</span>


</div>
<div class="viewcode-block" id="basictm"><a class="viewcode-back" href="../../pydna.html#pydna.amplify.basictm">[docs]</a><span class="k">def</span> <span class="nf">basictm</span><span class="p">(</span><span class="n">primer</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Returns the melting temperature (Tm) of the primer using</span>
<span class="sd">    the basic formula.</span>

<span class="sd">    | Tm = (wA+xT)*2 + (yG+zC)*4 assumed 50mM monovalent cations</span>
<span class="sd">    |</span>
<span class="sd">    | w = number of A in primer</span>
<span class="sd">    | x = number of T in primer</span>
<span class="sd">    | y = number of G in primer</span>
<span class="sd">    | z = number of C in primer</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    primer : string</span>
<span class="sd">        Primer sequence 5&#39;-3&#39;</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tm : int</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from pydna.amplify import basictm</span>
<span class="sd">    &gt;&gt;&gt; basictm(&quot;ggatcc&quot;)</span>
<span class="sd">    20</span>
<span class="sd">    &gt;&gt;&gt;</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">primer</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">primer</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">primer</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">primer</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&quot;t&quot;</span><span class="p">))</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">primer</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&quot;g&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">primer</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">))</span><span class="o">*</span><span class="mi">4</span>

<span class="c"># http://www.promega.com/techserv/tools/biomath/calc11.htm#melt_results</span>
</div>
<div class="viewcode-block" id="tmstaluc98"><a class="viewcode-back" href="../../pydna.html#pydna.amplify.tmstaluc98">[docs]</a><span class="k">def</span> <span class="nf">tmstaluc98</span><span class="p">(</span><span class="n">primer</span><span class="p">,</span> <span class="n">dnac</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">saltc</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Returns the melting temperature (Tm) of the primer using</span>
<span class="sd">    the nearest neighbour algorithm. Formula and thermodynamic data</span>
<span class="sd">    is taken from SantaLucia 1998 [1]_. This implementation gives the same</span>
<span class="sd">    answer as the one provided by Biopython (See Examples).</span>

<span class="sd">    Thermodynamic data used:</span>

<span class="sd">    =====  ====  ====</span>
<span class="sd">    pair   dH    dS</span>
<span class="sd">    =====  ====  ====</span>
<span class="sd">    AA/TT  7.9   22.2</span>
<span class="sd">    AT/TA  7.2   20.4</span>
<span class="sd">    TA/AT  7.2   21.3</span>
<span class="sd">    CA/GT  8.5   22.7</span>
<span class="sd">    GT/CA  8.4   22.4</span>
<span class="sd">    CT/GA  7.8   21.0</span>
<span class="sd">    GA/CT  8.2   22.2</span>
<span class="sd">    CG/GC  10.6  27.2</span>
<span class="sd">    GC/CG  9.8   24.4</span>
<span class="sd">    GG/CC  8.0   19.9</span>
<span class="sd">    =====  ====  ====</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    primer : string</span>
<span class="sd">        Primer sequence 5&#39;-3&#39; in UPPERCASE</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tm : float</span>
<span class="sd">        tm of the primer</span>


<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; from pydna.amplify import tmstaluc98</span>
<span class="sd">    &gt;&gt;&gt; from Bio.SeqUtils.MeltingTemp import Tm_staluc</span>
<span class="sd">    &gt;&gt;&gt; tmstaluc98(&quot;ACGTCATCGACACTATCATCGAC&quot;)</span>
<span class="sd">    54.55597724052518</span>
<span class="sd">    &gt;&gt;&gt;</span>



<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">nntermsl</span><span class="o">=</span><span class="p">{</span>  <span class="s">&quot;AA&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.9</span>  <span class="p">,</span> <span class="mf">22.2</span><span class="p">),</span>
                <span class="s">&quot;TT&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.9</span>  <span class="p">,</span> <span class="mf">22.2</span><span class="p">),</span>
                <span class="s">&quot;AT&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.2</span>  <span class="p">,</span> <span class="mf">20.4</span><span class="p">),</span>
                <span class="s">&quot;TA&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.2</span>  <span class="p">,</span> <span class="mf">21.3</span><span class="p">),</span>
                <span class="s">&quot;CA&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">8.5</span>  <span class="p">,</span> <span class="mf">22.7</span><span class="p">),</span>
                <span class="s">&quot;TG&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">8.5</span>  <span class="p">,</span> <span class="mf">22.7</span><span class="p">),</span>
                <span class="s">&quot;GT&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">8.4</span>  <span class="p">,</span> <span class="mf">22.4</span><span class="p">),</span>
                <span class="s">&quot;AC&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">8.4</span>  <span class="p">,</span> <span class="mf">22.4</span><span class="p">),</span>
                <span class="s">&quot;CT&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.8</span>  <span class="p">,</span> <span class="mf">21.0</span><span class="p">),</span>
                <span class="s">&quot;AG&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.8</span>  <span class="p">,</span> <span class="mf">21.0</span><span class="p">),</span>
                <span class="s">&quot;GA&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">8.2</span>  <span class="p">,</span> <span class="mf">22.2</span><span class="p">),</span>
                <span class="s">&quot;TC&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">8.2</span>  <span class="p">,</span> <span class="mf">22.2</span><span class="p">),</span>
                <span class="s">&quot;CG&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">10.6</span> <span class="p">,</span> <span class="mf">27.2</span><span class="p">),</span>
                <span class="s">&quot;GC&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">9.8</span>  <span class="p">,</span> <span class="mf">24.4</span><span class="p">),</span>
                <span class="s">&quot;GG&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">8</span>    <span class="p">,</span> <span class="mf">19.9</span><span class="p">),</span>
                <span class="s">&quot;CC&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">8</span>    <span class="p">,</span> <span class="mf">19.9</span><span class="p">),</span>
                <span class="s">&quot;A&quot;</span> <span class="p">:</span> <span class="p">(</span><span class="mi">0</span>    <span class="p">,</span> <span class="mi">0</span>   <span class="p">),</span>
                <span class="s">&quot;C&quot;</span> <span class="p">:</span> <span class="p">(</span><span class="mi">0</span>    <span class="p">,</span> <span class="mi">0</span>   <span class="p">),</span>
                <span class="s">&quot;G&quot;</span> <span class="p">:</span> <span class="p">(</span><span class="mi">0</span>    <span class="p">,</span> <span class="mi">0</span>   <span class="p">),</span>
                <span class="s">&quot;T&quot;</span> <span class="p">:</span> <span class="p">(</span><span class="mi">0</span>    <span class="p">,</span> <span class="mi">0</span>   <span class="p">)</span>  <span class="p">}</span>

    <span class="n">helixinit</span> <span class="o">=</span> <span class="p">{</span>   <span class="s">&quot;G&quot;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.1</span> <span class="p">,</span><span class="mf">2.8</span><span class="p">),</span>
                    <span class="s">&quot;C&quot;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.1</span> <span class="p">,</span><span class="mf">2.8</span><span class="p">),</span>
                    <span class="s">&quot;A&quot;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">2.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.1</span><span class="p">),</span>
                    <span class="s">&quot;T&quot;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">2.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.1</span><span class="p">)</span> <span class="p">}</span>

    <span class="n">dH</span><span class="p">,</span> <span class="n">dS</span> <span class="o">=</span> <span class="n">helixinit</span><span class="p">[</span><span class="n">primer</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">H</span> <span class="p">,</span>  <span class="n">S</span> <span class="o">=</span> <span class="n">helixinit</span><span class="p">[</span><span class="n">primer</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
    <span class="n">dH</span> <span class="o">=</span> <span class="n">dH</span><span class="o">+</span><span class="n">H</span>
    <span class="n">dS</span> <span class="o">=</span> <span class="n">dS</span><span class="o">+</span><span class="n">S</span>

    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">primer</span><span class="p">)):</span>
        <span class="n">dn</span> <span class="o">=</span> <span class="n">primer</span><span class="p">[</span><span class="n">p</span><span class="p">:</span><span class="n">p</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">H</span><span class="p">,</span><span class="n">S</span> <span class="o">=</span> <span class="n">nntermsl</span><span class="p">[</span><span class="n">dn</span><span class="p">]</span>
        <span class="n">dH</span><span class="o">+=</span><span class="n">H</span>
        <span class="n">dS</span><span class="o">+=</span><span class="n">S</span>
    <span class="n">R</span> <span class="o">=</span> <span class="mf">1.987</span> <span class="c"># universal gas constant in Cal/degrees C*Mol</span>
    <span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="n">dnac</span><span class="o">/</span><span class="mf">4.0</span><span class="p">)</span><span class="o">*</span><span class="mf">1e-9</span>
    <span class="n">dS</span> <span class="o">=</span> <span class="n">dS</span><span class="o">-</span><span class="mf">0.368</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">primer</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">saltc</span><span class="p">)</span><span class="o">/</span><span class="mf">1e3</span><span class="p">)</span>
    <span class="n">tm</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1000</span><span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">dH</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="o">-</span><span class="n">dS</span><span class="o">+</span><span class="p">(</span><span class="n">R</span> <span class="o">*</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">k</span><span class="p">)))))</span><span class="o">-</span><span class="mf">273.15</span>
    <span class="k">return</span> <span class="n">tm</span>
</div>
<div class="viewcode-block" id="tmbreslauer86"><a class="viewcode-back" href="../../pydna.html#pydna.amplify.tmbreslauer86">[docs]</a><span class="k">def</span> <span class="nf">tmbreslauer86</span><span class="p">(</span><span class="n">primer</span><span class="p">,</span> <span class="n">dnac</span><span class="o">=</span><span class="mf">500.0</span><span class="p">,</span> <span class="n">saltc</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span><span class="n">thermodynamics</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Returns the melting temperature (Tm) of the primer using</span>
<span class="sd">    the nearest neighbour algorithm. Formula and thermodynamic data</span>
<span class="sd">    is taken from Breslauer 1986. These data are no longer widely used.</span>


<span class="sd">    Breslauer 1986, table 2 [#]_</span>

<span class="sd">    =====  ===== ====   ===</span>
<span class="sd">    pair   dH    dS     dG</span>
<span class="sd">    =====  ===== ====   ===</span>
<span class="sd">    AA/TT  9.1   24.0   1.9</span>
<span class="sd">    AT/TA  8.6   23.9   1.5</span>
<span class="sd">    TA/AT  6.0   16.9   0.9</span>
<span class="sd">    CA/GT  5.8   12.9   1.9</span>
<span class="sd">    GT/CA  6.5   17.3   1.3</span>
<span class="sd">    CT/GA  7.8   20.8   1.6</span>
<span class="sd">    GA/CT  5.6   13.5   1.6</span>
<span class="sd">    CG/GC  11.9  27.8   3.6</span>
<span class="sd">    GC/CG  11.1  26.7   3.1</span>
<span class="sd">    GG/CC  11.0  26.6   3.1</span>
<span class="sd">    =====  ===== ====   ===</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    primer : string</span>
<span class="sd">        Primer sequence 5&#39;-3&#39; in UPPERCASE</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tm : float</span>


<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [#] K.J. Breslauer et al., “Predicting DNA Duplex Stability from the Base Sequence,” Proceedings of the National Academy of Sciences 83, no. 11 (1986): 3746.</span>


<span class="sd">    Examples</span>
<span class="sd">    ---------</span>

<span class="sd">    &gt;&gt;&gt; from pydna.amplify import tmbreslauer86</span>
<span class="sd">    &gt;&gt;&gt; tmbreslauer86(&quot;ACGTCATCGACACTATCATCGAC&quot;)</span>
<span class="sd">    64.28863985851899</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">nntermbr</span><span class="o">=</span><span class="p">{</span>  <span class="s">&quot;AA&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">9.1</span>   <span class="p">,</span><span class="mf">24.0</span>   <span class="p">,</span><span class="mf">1.9</span><span class="p">),</span>
                <span class="s">&quot;TT&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">9.1</span>   <span class="p">,</span><span class="mf">24.0</span>   <span class="p">,</span><span class="mf">1.9</span><span class="p">),</span>
                <span class="s">&quot;AT&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">8.6</span>   <span class="p">,</span><span class="mf">23.9</span>   <span class="p">,</span><span class="mf">1.5</span><span class="p">),</span>
                <span class="s">&quot;TA&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">6.0</span>   <span class="p">,</span><span class="mf">16.9</span>   <span class="p">,</span><span class="mf">0.9</span><span class="p">),</span>
                <span class="s">&quot;CA&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">5.8</span>   <span class="p">,</span><span class="mf">12.9</span>   <span class="p">,</span><span class="mf">1.9</span><span class="p">),</span>
                <span class="s">&quot;TG&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">5.8</span>   <span class="p">,</span><span class="mf">12.9</span>   <span class="p">,</span><span class="mf">1.9</span><span class="p">),</span>
                <span class="s">&quot;GT&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">6.5</span>   <span class="p">,</span><span class="mf">17.3</span>   <span class="p">,</span><span class="mf">1.3</span><span class="p">),</span>
                <span class="s">&quot;AC&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">6.5</span>   <span class="p">,</span><span class="mf">17.3</span>   <span class="p">,</span><span class="mf">1.3</span><span class="p">),</span>
                <span class="s">&quot;CT&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.8</span>   <span class="p">,</span><span class="mf">20.8</span>   <span class="p">,</span><span class="mf">1.6</span><span class="p">),</span>
                <span class="s">&quot;AG&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.8</span>   <span class="p">,</span><span class="mf">20.8</span>   <span class="p">,</span><span class="mf">1.6</span><span class="p">),</span>
                <span class="s">&quot;GA&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">5.6</span>   <span class="p">,</span><span class="mf">13.5</span>   <span class="p">,</span><span class="mf">1.6</span><span class="p">),</span>
                <span class="s">&quot;TC&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">5.6</span>   <span class="p">,</span><span class="mf">13.5</span>   <span class="p">,</span><span class="mf">1.6</span><span class="p">),</span>
                <span class="s">&quot;CG&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">11.9</span>  <span class="p">,</span><span class="mf">27.8</span>   <span class="p">,</span><span class="mf">3.6</span><span class="p">),</span>
                <span class="s">&quot;GC&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">11.1</span>  <span class="p">,</span><span class="mf">26.7</span>   <span class="p">,</span><span class="mf">3.1</span><span class="p">),</span>
                <span class="s">&quot;GG&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">11.0</span>  <span class="p">,</span><span class="mf">26.6</span>   <span class="p">,</span><span class="mf">3.1</span><span class="p">),</span>
                <span class="s">&quot;CC&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">11.0</span>  <span class="p">,</span><span class="mf">26.6</span>   <span class="p">,</span><span class="mf">3.1</span><span class="p">),</span>
                <span class="s">&quot;A&quot;</span> <span class="p">:</span> <span class="p">(</span><span class="mi">0</span>     <span class="p">,</span> <span class="mi">0</span>     <span class="p">,</span><span class="mi">0</span><span class="p">),</span>
                <span class="s">&quot;C&quot;</span> <span class="p">:</span> <span class="p">(</span><span class="mi">0</span>     <span class="p">,</span> <span class="mi">0</span>     <span class="p">,</span><span class="mi">0</span><span class="p">),</span>
                <span class="s">&quot;G&quot;</span> <span class="p">:</span> <span class="p">(</span><span class="mi">0</span>     <span class="p">,</span> <span class="mi">0</span>     <span class="p">,</span><span class="mi">0</span><span class="p">),</span>
                <span class="s">&quot;T&quot;</span> <span class="p">:</span> <span class="p">(</span><span class="mi">0</span>     <span class="p">,</span> <span class="mi">0</span>     <span class="p">,</span><span class="mi">0</span><span class="p">),</span>     <span class="p">}</span>
    <span class="n">dH</span><span class="o">=</span><span class="mf">3.4</span>
    <span class="n">dS</span><span class="o">=</span><span class="mf">12.4</span>
    <span class="n">dG</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">primer</span><span class="p">)):</span>
        <span class="n">dn</span> <span class="o">=</span> <span class="n">primer</span><span class="p">[</span><span class="n">p</span><span class="p">:</span><span class="n">p</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">H</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">G</span> <span class="o">=</span> <span class="n">nntermbr</span><span class="p">[</span><span class="n">dn</span><span class="p">]</span>
        <span class="n">dG</span><span class="o">+=</span><span class="n">G</span>
        <span class="n">dH</span><span class="o">+=</span><span class="n">H</span>
        <span class="n">dS</span><span class="o">+=</span><span class="n">S</span>

    <span class="n">R</span> <span class="o">=</span> <span class="mf">1.9872</span>          <span class="c"># universal gas constant in Cal/degrees C*Mol</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">dnac</span><span class="o">*</span><span class="mf">1E-9</span><span class="o">/</span><span class="mf">2.0</span>
    <span class="n">dH</span> <span class="o">=</span> <span class="n">dH</span> <span class="o">-</span> <span class="mi">5</span>
    <span class="n">dS</span> <span class="o">=</span> <span class="n">dS</span><span class="o">-</span><span class="mf">0.368</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">primer</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">saltc</span><span class="p">)</span><span class="o">/</span><span class="mf">1E3</span><span class="p">)</span> <span class="c"># SantaLucia salt correction formula</span>
    <span class="n">tm</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">*</span> <span class="o">-</span><span class="n">dH</span> <span class="o">/</span><span class="p">(</span><span class="o">-</span><span class="n">dS</span> <span class="o">+</span> <span class="n">R</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="p">)</span>  <span class="o">-</span> <span class="mf">273.15</span> <span class="c"># degrees Celsius</span>

    <span class="k">if</span> <span class="n">thermodynamics</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tm</span><span class="p">,</span><span class="n">dH</span><span class="p">,</span><span class="n">dS</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tm</span>

</div>
<div class="viewcode-block" id="tmbresluc"><a class="viewcode-back" href="../../pydna.html#pydna.amplify.tmbresluc">[docs]</a><span class="k">def</span> <span class="nf">tmbresluc</span><span class="p">(</span><span class="n">primer</span><span class="p">,</span> <span class="n">primerc</span><span class="o">=</span><span class="mf">500.0</span><span class="p">,</span> <span class="n">saltc</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">thermodynamics</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Returns the tm for a primer using a formula adapted to polymerases</span>
<span class="sd">    with a DNA binding domain.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    primer : string</span>
<span class="sd">        primer sequence 5&#39;-3&#39;</span>

<span class="sd">    primerc : float</span>
<span class="sd">       concentration (nM)</span>

<span class="sd">    saltc : float, optional</span>
<span class="sd">       Monovalent cation concentration (mM)</span>

<span class="sd">    thermodynamics : bool, optional</span>
<span class="sd">        prints details of the thermodynamic data to stdout. For</span>
<span class="sd">        debugging only.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tm : float</span>
<span class="sd">        the tm of the primer</span>

<span class="sd">    tm,dH,dS : tuple</span>
<span class="sd">        tm and dH and dS used for the calculation</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="kn">import</span> <span class="nn">thermodynamic_data</span>

    <span class="n">saltc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">saltc</span><span class="p">)</span><span class="o">/</span><span class="mi">1000</span>
    <span class="n">pri</span>  <span class="o">=</span> <span class="n">primerc</span><span class="o">/</span><span class="mf">10E7</span>
    <span class="n">dS</span> <span class="o">=</span> <span class="o">-</span><span class="mf">12.4</span>
    <span class="n">dH</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3400</span>

    <span class="n">STR</span> <span class="o">=</span> <span class="n">primer</span><span class="o">.</span><span class="n">lower</span><span class="p">();</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">STR</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">n1</span><span class="o">=</span><span class="nb">ord</span><span class="p">(</span><span class="n">STR</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">n2</span><span class="o">=</span><span class="nb">ord</span><span class="p">(</span><span class="n">STR</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">dH</span> <span class="o">+=</span> <span class="n">thermodynamic_data</span><span class="o">.</span><span class="n">dHBr</span><span class="p">[</span><span class="n">n1</span> <span class="o">-</span> <span class="mi">97</span><span class="p">][</span><span class="n">n2</span> <span class="o">-</span> <span class="mi">97</span><span class="p">]</span>
        <span class="n">dS</span> <span class="o">+=</span> <span class="n">thermodynamic_data</span><span class="o">.</span><span class="n">dSBr</span><span class="p">[</span><span class="n">n1</span> <span class="o">-</span> <span class="mi">97</span><span class="p">][</span><span class="n">n2</span> <span class="o">-</span> <span class="mi">97</span><span class="p">]</span>

    <span class="n">tm</span> <span class="o">=</span> <span class="p">(</span><span class="n">dH</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.9872</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">pri</span> <span class="o">/</span> <span class="mi">1600</span><span class="p">)</span> <span class="o">+</span> <span class="n">dS</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mf">16.6</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">saltc</span><span class="p">))</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span> <span class="o">-</span> <span class="mf">273.15</span>

    <span class="k">if</span> <span class="n">thermodynamics</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tm</span><span class="p">,</span><span class="n">dH</span><span class="p">,</span><span class="n">dS</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tm</span>
</div>
<span class="k">if</span> <span class="n">__name__</span><span class="o">==</span><span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">doctest</span>
    <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">Pydna 0.8.1 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2015, Björn Johansson.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>