

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Overview &mdash; Poezio 1.0-dev documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/poezio.png"/>
  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="Poezio 1.0-dev documentation" href="../index.html"/>
        <link rel="up" title="Development documentation" href="index.html"/>
        <link rel="next" title="Contributing" href="contributing.html"/>
        <link rel="prev" title="XEP" href="xep.html"/> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../index.html">Poezio</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installing poezio</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../install.html#poezio-in-the-gnu-linux-distributions">poezio in the GNU/Linux distributions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html#install-from-source">Install from source</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../configuration.html">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../configuration.html#global-section-options">Global section options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration.html#optional-section-options">Optional section options</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../usage.html">Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../usage.html#tab-list">Tab list</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage.html#generalities">Generalities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage.html#contact-list-tab">Contact list tab</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage.html#chatroom-tab">Chatroom tab</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage.html#private-tab">Private tab</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage.html#conversation-tab">Conversation tab</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage.html#dataforms-tab">Dataforms tab</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage.html#list-tab">List tab</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage.html#confirm-tab">Confirm tab</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage.html#bookmarks-tab">Bookmarks tab</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../commands.html">Commands</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../commands.html#global-commands">Global commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="../commands.html#chat-tab-commands">Chat tab commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="../commands.html#multiuserchat-tab-commands">MultiUserChat tab commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="../commands.html#private-tab-commands">Private tab commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="../commands.html#normal-conversation-tab-commands">Normal Conversation tab commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="../commands.html#contact-list-tab-commands">Contact list tab commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="../commands.html#xml-tab-commands">XML tab commands</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../keys.html">Keys</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../keys.html#key-bindings-listing">Key bindings listing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../keys.html#key-configuration">Key configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../keys.html#actions">Actions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../misc/index.html">Other topics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../misc/carbons.html">Message Carbons</a></li>
<li class="toctree-l2"><a class="reference internal" href="../misc/client_certs.html">Using client certificates to login</a></li>
<li class="toctree-l2"><a class="reference internal" href="../misc/correct.html">Message Correction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../misc/personal_events.html">Personal Events</a></li>
<li class="toctree-l2"><a class="reference internal" href="../misc/pyenv.html">Installing python 3.4 as a user</a></li>
<li class="toctree-l2"><a class="reference internal" href="../misc/separate.html">Using several accounts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../misc/ssl.html">TLS in poezio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../misc/troubleshooting.html">Troubleshooting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#anonymous-usage">Anonymous usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#normal-usage">Normal usage</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../themes.html">Themes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../themes.html#create-a-theme">Create a theme</a></li>
<li class="toctree-l2"><a class="reference internal" href="../themes.html#use-a-theme">Use a theme</a></li>
<li class="toctree-l2"><a class="reference internal" href="../themes.html#change-the-theme-directory">Change the theme directory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../themes.html#available-options">Available options</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../plugins/index.html">Plugins</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../plugins/index.html#setting-up-plugins">Setting up plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugins/index.html#plugin-autoload">Plugin autoload</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugins/index.html#manual-plugin-load">Manual plugin load</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugins/index.html#plugin-configuration">Plugin configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugins/index.html#plugin-index">Plugin index</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Development documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#about-plugins">About plugins</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#about-poezio">About Poezio</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top">…</i>
        <a href="../index.html">Poezio</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Development documentation</a> &raquo;</li>
      
    <li>Overview</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="../_sources/dev/overview.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="overview">
<span id="id1"></span><h1>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This is not an introduction to XMPP, but to how poezio works.</p>
</div>
<div class="section" id="global-overview">
<h2>Global overview<a class="headerlink" href="#global-overview" title="Permalink to this headline">¶</a></h2>
<p>Poezio is an application that has three main layers, mostly separated in three
different python modules: <code class="docutils literal"><span class="pre">core</span></code>, <code class="docutils literal"><span class="pre">tabs</span></code>, and <code class="docutils literal"><span class="pre">windows</span></code>. An UML diagram of
Poezio would be inneficient, cluttered, or incomplete, so there is none, if
that bugs you.</p>
<div class="figure">
<img alt="Layers" src="../_images/layers.png" />
</div>
<p><strong>Core</strong> is mostly a “global” object containing the state of the application at
any time, it contains the global commands, the xmpp event handlers, the list
of open tabs, etc. Most objects in poezio have a self.core attribute
referencing the <strong>Core</strong> (it’s a singleton, so there is never more than one
instance). <strong>Core</strong> also contains the main loop of the application, which then
dispatchs the I/O events (keypress) to the appropriate methods.</p>
<p>But the main loop is not the most important thing in poezio; because it is an
IM client, it is essentially event-driven. The event part is handled by
slixmpp, which is our fork of sleekxmpp to use asyncio instead of threads.</p>
<p><strong>Tabs</strong> are the second layer of poezio, but the first dealing with the UI: each
<strong>Tab</strong> is a layout of several <strong>windows</strong>, it contains tab-specific commands,
tab-specific keybinds, and it has methods in order for core to
interact with it, and some methods are only proxies for the methods of a
<strong>window</strong>.</p>
<p>Example scenario: If someone presses the key PageUp, then Core will call the
appropriate method on the current _Tab_, which will in turn, if it implements the
method (inherited empty from the Tab class), call a scrolling method from the
appropriate <strong>window</strong>.</p>
<p>All tabs types inherit from the class <strong>Tab</strong>, and the tabs featuring
chat functionnality will inherit from <strong>ChatTab</strong> (which inherits from <strong>Tab</strong>).</p>
<p>Examples of <strong>tabs</strong>: MUCTab, XMLTab, RosterTab, MUCListTab, etc…</p>
</div>
<div class="section" id="event-handlers">
<h2>Event handlers<a class="headerlink" href="#event-handlers" title="Permalink to this headline">¶</a></h2>
<p>The events handlers are registered right at the start of poezio, and then
when a matching stanza is received, the handler is called. The handlers are
in <strong>Core</strong>, and then they call the appropriate methods in the corresponding
<strong>tabs</strong>.</p>
<p>Example scenario: if a message is received from a MUC, then the <strong>Core</strong> handler
will identify the <strong>Tab</strong>, and call the relevant handler from this <strong>Tab</strong>, this tab
will in turn, add the message to the buffer, which will then add it to the
relevant <strong>windows</strong>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">All the _windows_ that deal with received or generated text are linked
to a <strong>text_buffer</strong>, in order to rebuild all the display lines from the
sources if necessary. This also enables us to have several <strong>windows</strong>
presenting the same text, even if they are not of the same size and layout.</p>
</div>
</div>
<div class="section" id="commands-and-completion">
<h2>Commands and completion<a class="headerlink" href="#commands-and-completion" title="Permalink to this headline">¶</a></h2>
<p>Commands are quite straightforward: those are methods that take a string as a
parameter, and they do stuff.</p>
<p>From an user point of view, the methods are entered like that:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>/command arg1 arg2
</pre></div>
</div>
<p>or</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>/command &quot;arg1 with spaces&quot; arg2
</pre></div>
</div>
<p>However, when creating a command, you wil deal with _one_ str, no matter what.
There are utilities to deal with it (common.shell_split), but it is not always
necessary. Commands are registered in the <strong>commands</strong> dictionnary of a tab
structured as key (command name) -&gt; tuple(command function, help string, completion).</p>
<p>Completions are a bit tricky, but it’s easy once you get used to it:</p>
<p>They take an <strong>Input</strong> (a _windows_ class) as a parameter, named the_input
everywhere in the sources. To effectively have a completion, you have to create
a <code class="xref py py-class docutils literal"><span class="pre">poezio.core.structs.Completion</span></code> object initialized with the
completion you want to call
(<strong>the_input.auto_completion()</strong> or <strong>the_input.new_completion()</strong>) with the
relevant parameters and return it with the function. Previously you would call
the function directly from the completion method, but having side effects
inside it makes it harder to test.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Input</span><span class="p">(</span><span class="n">Win</span><span class="p">):</span>
    <span class="c1"># …</span>
    <span class="k">def</span> <span class="nf">auto_completion</span><span class="p">(</span><span class="n">completion_list</span><span class="p">,</span> <span class="n">after</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">quotify</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="c1"># …</span>

    <span class="k">def</span> <span class="nf">new_completion</span><span class="p">(</span><span class="n">completion_list</span><span class="p">,</span> <span class="n">argument_position</span><span class="p">,</span> <span class="n">after</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">quotify</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="c1"># …</span>
</pre></div>
</div>
<p>Set the input to iterate over <strong>completion_list</strong> when the user hits tab, to insert
<strong>after</strong> after the completed item, and surround the item with double quotes or
not.</p>
<p>To find the current completed argument, use the <strong>input.get_argument_position()</strong>
method. You can then use <strong>new_completion()</strong> to select the argument to be completed.</p>
<p>You can look for examples in the sources, all the possible cases are
covered (single-argument, complex arguments with spaces, several arguments,
etc…).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Only <strong>new_completion()</strong> used together with <strong>get_argument_position()</strong> allow
completing arguments that are not at the end of the command line, therefore it
is preferable to use that and not <strong>auto_completion()</strong>.</p>
</div>
<div class="section" id="dealing-with-the-command-line">
<h3>Dealing with the command line<a class="headerlink" href="#dealing-with-the-command-line" title="Permalink to this headline">¶</a></h3>
<p>For convenience’s sake, poezio includes a <strong>decorators</strong> module containing a
<strong>command_args_parser</strong>, which can be used to filter the input easily.</p>
<p>Examples:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">decorators</span> <span class="kn">import</span> <span class="n">command_args_parser</span>
<span class="k">class</span> <span class="nc">MyClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="nd">@command_args_parser.raw</span>
    <span class="k">def</span> <span class="nf">command_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raw</span><span class="p">):</span>
        <span class="c1"># the &quot;raw&quot; parameter will be the raw input string</span>

    <span class="nd">@command_args_parser.ignored</span>
    <span class="k">def</span> <span class="nf">command_ignored</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># no argument is given to that function</span>

    <span class="nd">@command_args_parser.quoted</span><span class="p">(</span><span class="n">mandatory</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">command_quoted_1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="c1"># the &quot;args&quot; parameter will be a list containing one argument</span>
</pre></div>
</div>
<p>See the source of the CommandArgParser for more information.</p>
<dl class="class">
<dt id="poezio.decorators.CommandArgParser">
<em class="property">class </em><code class="descclassname">poezio.decorators.</code><code class="descname">CommandArgParser</code><a class="reference internal" href="../_modules/poezio/decorators.html#CommandArgParser"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#poezio.decorators.CommandArgParser" title="Permalink to this definition">¶</a></dt>
<dd><p>Modify the string argument of the function into a list of strings
containing the right number of extracted arguments, or None if we don’t
have enough.</p>
</dd></dl>

</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="contributing.html" class="btn btn-neutral float-right" title="Contributing">Next</a>
      
      
        <a href="xep.html" class="btn btn-neutral" title="XEP">Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Mathieu Pasquet - Florent Le Coz.
      Last updated on Oct 09, 2016.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0-dev',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

   
</body>
</html>