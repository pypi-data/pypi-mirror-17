

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>OTR &mdash; Poezio 1.0-dev documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/poezio.png"/>
  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="Poezio 1.0-dev documentation" href="../index.html"/>
        <link rel="up" title="Plugins" href="index.html"/>
        <link rel="next" title="Pacokick" href="pacokick.html"/>
        <link rel="prev" title="Mpd client" href="mpd_client.html"/> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../index.html">Poezio</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installing poezio</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../install.html#poezio-in-the-gnu-linux-distributions">poezio in the GNU/Linux distributions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install.html#install-from-source">Install from source</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../configuration.html">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../configuration.html#global-section-options">Global section options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration.html#optional-section-options">Optional section options</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../usage.html">Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../usage.html#tab-list">Tab list</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage.html#generalities">Generalities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage.html#contact-list-tab">Contact list tab</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage.html#chatroom-tab">Chatroom tab</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage.html#private-tab">Private tab</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage.html#conversation-tab">Conversation tab</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage.html#dataforms-tab">Dataforms tab</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage.html#list-tab">List tab</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage.html#confirm-tab">Confirm tab</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage.html#bookmarks-tab">Bookmarks tab</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../commands.html">Commands</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../commands.html#global-commands">Global commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="../commands.html#chat-tab-commands">Chat tab commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="../commands.html#multiuserchat-tab-commands">MultiUserChat tab commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="../commands.html#private-tab-commands">Private tab commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="../commands.html#normal-conversation-tab-commands">Normal Conversation tab commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="../commands.html#contact-list-tab-commands">Contact list tab commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="../commands.html#xml-tab-commands">XML tab commands</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../keys.html">Keys</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../keys.html#key-bindings-listing">Key bindings listing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../keys.html#key-configuration">Key configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../keys.html#actions">Actions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../misc/index.html">Other topics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../misc/carbons.html">Message Carbons</a></li>
<li class="toctree-l2"><a class="reference internal" href="../misc/client_certs.html">Using client certificates to login</a></li>
<li class="toctree-l2"><a class="reference internal" href="../misc/correct.html">Message Correction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../misc/personal_events.html">Personal Events</a></li>
<li class="toctree-l2"><a class="reference internal" href="../misc/pyenv.html">Installing python 3.4 as a user</a></li>
<li class="toctree-l2"><a class="reference internal" href="../misc/separate.html">Using several accounts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../misc/ssl.html">TLS in poezio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../misc/troubleshooting.html">Troubleshooting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#anonymous-usage">Anonymous usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html#normal-usage">Normal usage</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../themes.html">Themes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../themes.html#create-a-theme">Create a theme</a></li>
<li class="toctree-l2"><a class="reference internal" href="../themes.html#use-a-theme">Use a theme</a></li>
<li class="toctree-l2"><a class="reference internal" href="../themes.html#change-the-theme-directory">Change the theme directory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../themes.html#available-options">Available options</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Plugins</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#setting-up-plugins">Setting up plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#plugin-autoload">Plugin autoload</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#manual-plugin-load">Manual plugin load</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#plugin-configuration">Plugin configuration</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#plugin-index">Plugin index</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../dev/index.html">Development documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../dev/index.html#about-plugins">About plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/index.html#about-poezio">About Poezio</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top">…</i>
        <a href="../index.html">Poezio</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Plugins</a> &raquo;</li>
      
    <li>OTR</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="../_sources/plugins/otr.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="module-otr">
<span id="otr"></span><span id="otr-plugin"></span><h1>OTR<a class="headerlink" href="#module-otr" title="Permalink to this headline">¶</a></h1>
<p>This plugin implements <a class="reference external" href="http://wiki.xmpp.org/web/OTR">Off The Record messaging</a>.</p>
<p>This is a plugin used to encrypt a one-to-one conversation using the OTR
encryption method. You can use it if you want good privacy, deniability,
authentication, and strong secrecy. Without this encryption, your messages
are encrypted <strong>at least</strong> from your client (poezio) to your server. The
message is decrypted by your server and you cannot control the encryption
method of your messages from your server to your contact’s server (unless
you are your own server’s administrator), nor from your contact’s server
to your contact’s client.</p>
<p>This plugin does end-to-end encryption. This means that <strong>only</strong> your contact can
decrypt your messages, and it is fully encrypted during <strong>all</strong> its travel
through the internet.</p>
<p>Note that if you are having an encrypted conversation with a contact, you can
<strong>not</strong> send XHTML-IM messages to them (or correct messages, or anything more than
raw text). All formatting will be removed and be replaced by plain text messages.</p>
<p>This is a limitation of the OTR protocol, and it will never be fixed. Some clients
like Pidgin-OTR try do do magic stuff with html unescaping inside the OTR body, and
it is not pretty.</p>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>To use the OTR plugin, you must first install pure-python-otr and pycrypto
(for python3).</p>
<p>You have to install it from the git because a few issues were
found with the python3 compatibility while writing this plugin,
and the fixes did not make it into a stable release yet.</p>
<p>Install the python module:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>git clone https://github.com/afflux/pure-python-otr.git
<span class="nb">cd</span> pure-python-otr
python3 setup.py install --user
</pre></div>
</div>
<p>You can also use pip in a virtualenv (built-in as <a class="reference external" href="https://docs.python.org/3/using/scripts.html#pyvenv-creating-virtual-environments">pyvenv</a> with python since 3.3)
with the requirements.txt at the root of the poezio directory.</p>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>Command added to Conversation Tabs and Private Tabs:</p>
<dl class="glossary docutils">
<dt id="term-otr">/otr</dt>
<dd><p class="first"><strong>Usage:</strong> <code class="docutils literal"><span class="pre">/otr</span> <span class="pre">[start|refresh|end|fpr|ourfpr|trust|untrust]</span></code></p>
<p>This command is used to manage an OTR private session.</p>
<ul class="simple">
<li>The <code class="docutils literal"><span class="pre">start</span></code> (or <code class="docutils literal"><span class="pre">refresh</span></code>) command starts or refreshs a private OTR session</li>
<li>The <code class="docutils literal"><span class="pre">end</span></code> command ends a private OTR session</li>
<li>The <code class="docutils literal"><span class="pre">fpr</span></code> command gives you the fingerprint of the key of the remote entity</li>
<li>The <code class="docutils literal"><span class="pre">ourfpr</span></code> command gives you the fingerprint of your own key</li>
<li>The <code class="docutils literal"><span class="pre">trust</span></code> command marks the current remote key as trusted for the current remote JID</li>
<li>The <code class="docutils literal"><span class="pre">untrust</span></code> command removes that trust</li>
<li>Finally, the <code class="docutils literal"><span class="pre">drop</span></code> command is used if you want to delete your private key (not recoverable).</li>
</ul>
<div class="last admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">With <code class="docutils literal"><span class="pre">drop</span></code>, the private key is only removed from the filesystem,
<em>NOT</em> with multiple rewrites in a secure manner, you should do that
yourself if you want to be sure.</p>
</div>
</dd>
<dt id="term-otrsmp">/otrsmp</dt>
<dd><p class="first"><strong>Usage:</strong> <code class="docutils literal"><span class="pre">/otrsmp</span> <span class="pre">&lt;ask|answer|abort&gt;</span> <span class="pre">[question]</span> <span class="pre">[secret]</span></code></p>
<p>Verify the identify of your contact by using a pre-defined secret.</p>
<ul class="last simple">
<li>The <code class="docutils literal"><span class="pre">abort</span></code> command aborts an ongoing verification</li>
<li>The <code class="docutils literal"><span class="pre">ask</span></code> command start a verification, with a question or not</li>
<li>The <code class="docutils literal"><span class="pre">answer</span></code> command sends back the answer and finishes the verification</li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="managing-trust">
<h2>Managing trust<a class="headerlink" href="#managing-trust" title="Permalink to this headline">¶</a></h2>
<p>An OTR conversation can be started with a simple <code class="docutils literal"><span class="pre">/otr</span> <span class="pre">start</span></code> and the
conversation will be encrypted. However it is very often useful to check
that your are talking to the right person.</p>
<p>To this end, two actions are available, and a message explaining both
will be prompted each time an <strong>untrusted</strong> conversation is started:</p>
<ul class="simple">
<li>Checking the knowledge of a shared secret through the use of <a class="reference internal" href="#term-otrsmp"><span class="xref std std-term">/otrsmp</span></a></li>
<li>Exchanging fingerprints (<code class="docutils literal"><span class="pre">/otr</span> <span class="pre">fpr</span></code> and <code class="docutils literal"><span class="pre">/otr</span> <span class="pre">ourfpr</span></code>) out of band (in a secure channel) to check that both match,
then use <code class="docutils literal"><span class="pre">/otr</span> <span class="pre">trust</span></code> to add then to the list of trusted fingerprints for this JID.</li>
</ul>
</div>
<div class="section" id="files">
<h2>Files<a class="headerlink" href="#files" title="Permalink to this headline">¶</a></h2>
<p>This plugin creates trust files complatible with libotr and the files produced by gajim.</p>
<p>The files are located in <code class="file docutils literal"><span class="pre">$XDG_DATA_HOME/poezio/otr/</span></code> by default (so
<code class="file docutils literal"><span class="pre">~/.local/share/poezio/otr</span></code> in most cases).</p>
<p>Two files are created:</p>
<ul class="simple">
<li>An account_jid.key3 (<code class="file docutils literal"><span class="pre">example&#64;example.com.key3</span></code>) file, which contains the private key</li>
<li>An account_jid.fpr (<code class="file docutils literal"><span class="pre">example&#64;example.com.fpr</span></code>) file, which contains the list of trusted
(or untrusted) JIDs and keys.</li>
</ul>
</div>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<dl class="glossary docutils">
<dt id="term-decode-entities">decode_entities</dt>
<dd><p class="first"><strong>Default:</strong> <code class="docutils literal"><span class="pre">true</span></code></p>
<p class="last">Decode XML and HTML entities (like <code class="docutils literal"><span class="pre">&amp;amp;</span></code>) even when the
document isn&#8217;t valid (if it is valid, it will be decoded even
without this option).</p>
</dd>
<dt id="term-decode-newlines">decode_newlines</dt>
<dd><p class="first"><strong>Default:</strong> <code class="docutils literal"><span class="pre">true</span></code></p>
<p class="last">Decode <code class="docutils literal"><span class="pre">&lt;br/&gt;</span></code> and <code class="docutils literal"><span class="pre">&lt;br&gt;</span></code> tags even when the document
isn&#8217;t valid (if it is valid, it will be decoded even
without this option for <code class="docutils literal"><span class="pre">&lt;br/&gt;</span></code>, and <code class="docutils literal"><span class="pre">&lt;br&gt;</span></code> will make
the document invalid anyway).</p>
</dd>
<dt id="term-decode-xhtml">decode_xhtml</dt>
<dd><p class="first"><strong>Default:</strong> <code class="docutils literal"><span class="pre">true</span></code></p>
<p class="last">Decode embedded XHTML.</p>
</dd>
<dt id="term-keys-dir">keys_dir</dt>
<dd><p class="first"><strong>Default:</strong> <code class="docutils literal"><span class="pre">$XDG_DATA_HOME/poezio/otr</span></code></p>
<p class="last">The directory in which you want keys and fpr to be stored.</p>
</dd>
<dt id="term-log">log</dt>
<dd><p class="first"><strong>Default:</strong> <code class="docutils literal"><span class="pre">false</span></code></p>
<p class="last">Log conversations (OTR start/end marker, and messages).</p>
</dd>
<dt id="term-require-encryption">require_encryption</dt>
<dd><p class="first"><strong>Default:</strong> <code class="docutils literal"><span class="pre">false</span></code></p>
<p class="last">If <code class="docutils literal"><span class="pre">true</span></code>, prevents you from sending unencrypted messages, and tries
to establish OTR sessions when receiving unencrypted messages.</p>
</dd>
<dt id="term-timeout">timeout</dt>
<dd><p class="first"><strong>Default:</strong> <code class="docutils literal"><span class="pre">3</span></code></p>
<p class="last">The number of seconds poezio will wait until notifying you
that the OTR session was not established. A negative or null
value will disable this notification.</p>
</dd>
</dl>
<p>The <a class="reference internal" href="#term-require-encryption"><span class="xref std std-term">require_encryption</span></a>, <a class="reference internal" href="#term-decode-xhtml"><span class="xref std std-term">decode_xhtml</span></a>, <a class="reference internal" href="#term-decode-entities"><span class="xref std std-term">decode_entities</span></a>
and <a class="reference internal" href="#term-log"><span class="xref std std-term">log</span></a> configuration parameters are tab-specific.</p>
</div>
<div class="section" id="important-details">
<h2>Important details<a class="headerlink" href="#important-details" title="Permalink to this headline">¶</a></h2>
<p>The OTR session is considered for a full JID (e.g. <a class="reference external" href="mailto:toto&#37;&#52;&#48;example/">toto<span>&#64;</span>example/</a><strong>client1</strong>),
but the trust is set with a bare JID (e.g. <a class="reference external" href="mailto:toto&#37;&#52;&#48;example">toto<span>&#64;</span>example</a>). This is important
in the case of Private Chats (in a chatroom), since you cannot always get the
real JID of your contact (or check if the same nick is used by different people).</p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="pacokick.html" class="btn btn-neutral float-right" title="Pacokick">Next</a>
      
      
        <a href="mpd_client.html" class="btn btn-neutral" title="Mpd client">Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Mathieu Pasquet - Florent Le Coz.
      Last updated on Oct 09, 2016.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0-dev',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

   
</body>
</html>