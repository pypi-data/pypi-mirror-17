

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>WSGI Deployment Issues &mdash; Exordium 1.0.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Exordium 1.0.0 documentation" href="index.html"/>
        <link rel="next" title="Migration from Other Libraries" href="migration.html"/>
        <link rel="prev" title="Screenshots" href="screenshots.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Exordium
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Exordium Music Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="assumptions_limitations.html">Assumptions and Limitations</a></li>
<li class="toctree-l1"><a class="reference internal" href="requirements.html">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="quick_start.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="administration.html">Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="screenshots.html">Screenshots</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">WSGI Deployment Issues</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#locale-issues">Locale Issues</a></li>
<li class="toctree-l2"><a class="reference internal" href="#process-count">Process Count</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="migration.html">Migration from Other Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="apache_deployment_howto.html">CentOS 7 Apache/WSGI Deployment HOWTO</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Exordium</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>WSGI Deployment Issues</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/wsgi_deployments.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="wsgi-deployment-issues">
<h1>WSGI Deployment Issues<a class="headerlink" href="#wsgi-deployment-issues" title="Permalink to this headline">¶</a></h1>
<div class="section" id="locale-issues">
<h2>Locale Issues<a class="headerlink" href="#locale-issues" title="Permalink to this headline">¶</a></h2>
<p>If deploying via WSGI (on Apache, at least), there&#8217;s a serious problem
which can occur if any non-ASCII characters are found in your filenames.
Basically, by default the WSGI process will be launched with a $LANG of
&#8220;C&#8221;, making ascii the default encoding for various things, including the
filesystem encoding as reported by <code class="docutils literal"><span class="pre">sys.getfilesystemencoding()</span></code>.  If you
try and import any files with non-ASCII characters in the filename, you can
end up with absurd errors like this in your logs:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="ne">UnicodeEncodeError</span><span class="p">:</span> <span class="s1">&#39;utf-8&#39;</span> <span class="n">codec</span> <span class="n">can</span><span class="s1">&#39;t encode character &#39;</span>\\<span class="n">udcc3</span><span class="s1">&#39; in position 7160: surrogates not allowed</span>
</pre></div>
</div>
<p>This behavior is especially difficult to track down since it will NOT
be repeatable in any unit tests, nor will it be repeatable when running
the development test server - it&#8217;ll only ever show up in the WSGI
deployment.</p>
<p>Currently Exordium doesn&#8217;t have a check for this - I&#8217;ll hope to
eventually add that in - but for now just make sure that you&#8217;re specifying
the following after your <code class="docutils literal"><span class="pre">WSGIDaemonProcess</span></code> line:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en_US.UTF-8&#39;</span> <span class="n">locale</span><span class="o">=</span><span class="s1">&#39;en_US.UTF-8&#39;</span>
</pre></div>
</div>
<p>Of course, replacing the encoding with the proper one for the data stored
on your filesystem.</p>
<p>There may be some similar problems if more than one encoding is found in
your system&#8217;s filenames - that&#8217;s another thing I have yet to investigate.</p>
<p>You can read a bit more on this problem here, FWIW:
<a class="reference external" href="http://blog.dscpl.com.au/2014/09/setting-lang-and-lcall-when-using.html">http://blog.dscpl.com.au/2014/09/setting-lang-and-lcall-when-using.html</a></p>
</div>
<div class="section" id="process-count">
<h2>Process Count<a class="headerlink" href="#process-count" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal"><span class="pre">WSGIDaemonProcess</span></code> parameter in Apache lets you specify an arbitrary
number of <code class="docutils literal"><span class="pre">processes</span></code> (in addition to <code class="docutils literal"><span class="pre">threads</span></code>).  If <code class="docutils literal"><span class="pre">processes</span></code> is
set to more than 1, problems can be encountered when setting preferences
(such as library path, download URLs, live album display, etc).  Namely,
the preference change will often only be seen by the process in which it
was changed, which can lead to some vexing behavior.</p>
<p>I believe the root of this problem is that the dynamic_preferences module
uses a cache (presumably a builtin Django cache), and that cache must be
configured properly so that multiple processes can share it, but I have not
actually investigated this.  Given that my personal activity needs with
Exordium are quite light, I&#8217;ve just made do with a single process.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="migration.html" class="btn btn-neutral float-right" title="Migration from Other Libraries" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="screenshots.html" class="btn btn-neutral" title="Screenshots" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, CJ Kucera.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.0.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>