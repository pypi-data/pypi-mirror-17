<!DOCTYPE html>
<!--
# Copyright (C) 2015 INRA
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<html>
    <head>
        <title>Stacks Statistics</title>
        <meta charset="UTF-8">
        <meta name="version" content="1.0.0">
        <!-- CSS -->
        <link rel="stylesheet" href="https://cdn.datatables.net/1.10.6/css/jquery.dataTables.css"></link>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css"></link>
        <style type="text/css">
            #js-alert {
                width: 90%;
                margin-right: auto;
                margin-left: auto;
            }
            #content {
                width: 90%;
                margin-right: auto;
                margin-left: auto;
            }
            .clear {
                clear: both;
                height: 0px;
                width: 100%;
                float: none !important;
            }
        </style>
        <!-- JS -->
        <script type="text/javascript" src="http://code.jquery.com/jquery-2.1.3.min.js"></script>
        <script type="text/javascript" src="http://code.highcharts.com/4.1.4/highcharts.js"></script>
        <script type="text/javascript" src="http://code.highcharts.com/4.1.4/modules/exporting.js"></script>
        <script type="text/javascript" src="https://cdn.datatables.net/1.10.6/js/jquery.dataTables.min.js"></script>
        <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
        <script type="text/javascript">
            /*
             * HTMLTable.js 0.1.0 - HTMLTable Library
             *
             * Copyright (c) 2015 Escudie Frederic
             * Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
             */
            function HTMLtable(e){var t,r,n=e,a=";";this.deleteColumns=function(e){for(var a=n.getElementsByTagName("tr"),o=0;o<a.length;o++){s=0;var i=a[o].getElementsByTagName("td");0==i.length&&(i=a[o].getElementsByTagName("th"));for(var v=0,s=0;s<t[1];s++)if(!r[o][s]){var f=i[v].getAttribute("colspan");if(null!=f)for(var m=0;f>m;m++){if(in_array(s+m,e)){var u=i[v].getAttribute("colspan");u-1==0?i[v].removeAttribute("colspan"):i[v].setAttribute("colspan",u-1)}if(null==i[v].getAttribute("colspan")){var h=i[v];a[o].removeChild(h),v--}}else if(in_array(s,e)){var h=i[v];a[o].removeChild(h),v--}v++}}l(),g()},this.filter=function(e,a){var l=new RegExp(e),g=new Array;null!=a&&a||(g.c0=!0);for(var o=n.getElementsByTagName("tr"),i=0;i<o.length;i++){f=0;var v=o[i].getElementsByTagName("td");if(0!=v.length)for(var s=0,f=0;f<t[1];f++)r[i][f]||(l.test(v[s].innerHTML)&&(g["c"+f]=!0),s++)}for(var m=new Array,u=0;u<t[1];u++)void 0===g["c"+u]&&m.push(u);this.deleteColumns(m)},this.getModel=function(){return n};var l=function(){for(var e=0,r=0,a=n.getElementsByTagName("tr"),l=0;l<a.length;l++){var g=0;e++;var o=a[l].getElementsByTagName("td");0==o.length&&(o=a[l].getElementsByTagName("th"));for(var i=0;i<o.length;i++){var v=o[i].getAttribute("colspan");g+=null==v?1:parseInt(v)}g>r&&(r=g)}t=new Array(2),t[0]=e,t[1]=r},g=function(){r=new Array(t[0]);for(var e=0;e<t[0];e++){r[e]=new Array(t[1]);for(var a=0;a<t[1];a++)r[e][a]=!1}for(var l=n.getElementsByTagName("tr"),g=0;g<l.length;g++){v=0;var o=l[g].getElementsByTagName("td");0==o.length&&(o=l[g].getElementsByTagName("th"));for(var i=0,v=0;v<t[1];v++)if(!r[g][v]){var s=0,f=0,m=o[i].getAttribute("rowspan");null!=m&&(s=parseInt(m)-1);var u=o[i].getAttribute("colspan");null!=u&&(f=parseInt(u)-1);for(var h=s;h>=0;h--)for(var y=f;y>=0;y--)(0!=h||0!=y)&&(r[g+h][v+y]=!0);i++}}};this.replace=function(e,a,l){var g=new RegExp(e);null==a&&(a=""),null==l&&(l="");for(var o=n.getElementsByTagName("tr"),i=0;i<o.length;i++){f=0;var v=o[i].getElementsByTagName("td");if(0!=v.length)for(var s=0,f=0;f<t[1];f++)if(!r[i][f]){var m=g.exec(v[s].innerHTML);null!=m&&(void 0===m[1]&&(m[1]=""),v[s].innerHTML=a+m[1]+l),s++}}},this.toCSV=function(){for(var e="",l=n.getElementsByTagName("tr"),g=0;g<l.length;g++){var o=l[g].getElementsByTagName("td");0==o.length&&(o=l[g].getElementsByTagName("th"));for(var i=0,v=0;v<t[1];v++)r[g][v]||(e+=o[i].innerHTML,i++),e+=a;e=e.substr(0,e.length-1)+"\n"}return e},l(),console.log(t),g(),console.log(r)}var in_array=function(e,t){for(var r in t)if(t[r]==e)return!0;return!1};
            
            /*
             * dataTableExtractor.plugin.js 0.1.0 - datatableExport Library
             *
             * Copyright (c) 2015 Escudie Frederic
             * Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
             */
            !function(t){t.fn.datatableExport=function(a){var e={anchor_id:t(this).attr("id"),table_id:null,csv_separator:";",omitted_columns:[]},n=t.extend(e,a);if(!t(this).length)throw"The element where the datatableExport is called does not exist.";if(void 0==n.anchor_id)throw"The datatableExport plugin must be called on an element with id.";if(null==n.table_id)throw"You must set the table_id parameter in datatableExport plugin.";if(!t("#"+n.table_id))throw"The datatable '#"+n.table_id+"' cannot be retieve in DOM.";return this.each(function(){var a=t(this);a.on("click",function(){t.fn.datatableExport.csv(n.anchor_id,n.table_id,n.csv_separator,n.omitted_columns)})})},t.fn.datatableExport.cleanCellMarkup=function(a,e){t.parseHTML(e);t("#"+a).append('<div class="hidden data-tmp">'+e+"</div>"),t("#"+a+" .data-tmp").find("input").each(function(){var a="";a=t(this).is(":checkbox")?t(this).is(":checked")?"true":"false":t(this).val(),t(this).replaceWith(a)});var n=t("#"+a+" .data-tmp").text();return t("#"+a+" .data-tmp").remove(),n},t.fn.datatableExport.csv=function(a,e,n,i){var l="",r=t("#"+e).DataTable(),d=t("#"+e+" thead")[0],o=new HTMLtable(d.cloneNode(!0));o.deleteColumns(i),l+=o.toCSV();var c=r.rows().data();t.each(c,function(e,n){for(var r="",d=0;d<n.length;d++)-1==t.inArray(d,i)&&(r+='"'+t.fn.datatableExport.cleanCellMarkup(a,n[d])+'";');""!=r&&(r=r.slice(0,-1)),l+=r+"\n"}),t("#"+a+"-extract-csv").length||t("#"+a).append('<a id="'+a+'-extract-csv" href="data:text/csv;charset=UTF-8,'+encodeURI(l)+'" download="data.csv" style="display:none;"></a>'),t("#"+a+"-extract-csv")[0].click()}}(jQuery);
        </script>
        <script type="text/javascript">
            /**
             * Returns the string representation of the number. 
             * @param pValue {Float} The number to process.
             * @return {String} The string representation (example: 12856892.11111 => 12,856,892.11).
             */
            var numberDisplay = function( pValue ){
                var new_val = "" ;
                if( ("" + pValue + "").indexOf(".") != -1 ){
                    new_val = pValue.toFixed(2).replace(/(\d)(?=(\d{3})+\b)/g, '$1,');
                } else {
                    new_val = pValue.toFixed().replace(/(\d)(?=(\d{3})+\b)/g, '$1,');
                }
                return new_val ;
            }
            
            /**
             * Returns hash use to init HightChart line. 
             * @param pTitle {String} The title of the chart.
             * @param pXTitle {String} The xAxis title.
             * @param pYTitle {String} The yAxis title.
             * @param pXCategories {Array} x scale labels.
             * @param pData {Array} The HightChart series.
             * @return {Hash} Parameters to use in Highchart's constructor.
             */
            var lineplot_param = function(pTitle, pType, pXTitle, pYTitle, enableLeg, pData) {
                return {
                    chart: {
                        type: pType,
                        zoomType : "xy"
                    },
                    colors : [
                            '#F8A848', '#4E9A06'
                    ] ,
                    title: {
                        text: pTitle
                    },
                    subtitle: {
                        text: 'Click and drag to zoom in.'
                    },
                    xAxis: {
                        title: {
                            text: pXTitle
                        },
                        tickInterval : 1
                    },
                    yAxis: {
                        min: 0,
                        title: {
                            text: pYTitle
                        }
                    },
                    tooltip:  {
                        formatter:function() {
                            tooltip_head = pXTitle + ' : <b> ' + this.x  + '</b>';
                            tooltip_body = '<tr><td>' + pYTitle + ' <b>' + this.y + '</b></td></tr>';
                            return tooltip_head +  '<table>' + tooltip_body + '</table>' ; ;
                        },
                        useHTML: true
                    },
                    series: pData,
                    legend: {
                        enabled: enableLeg
                    },
                    credits: {
                        enabled: false
                    }
                };
            }

            /**
             * Returns hash use to init HightChart column. 
             * @param pTitle {String} The title of the chart.
             * @param pYTitle {String} The yAxis title.
             * @param pCategories {Array} x scale labels.
             * @param pSeries {Array} The HightChart series.
             * @param unity {String} Unity used in tooltip.
             * @return {Hash} Parameters to use in Highchart's constructor.
             */           
            var histogram_param = function( pTitle, pYTitle, pCategories, pSeries, unity ) {
                var param = {
                    chart: {
                        type: 'column',
                        zoomType : "xy"
                    },
                    colors : [
                            '#4E9A06', '#F8A848'
                    ] ,
                    title: {
                        text: pTitle
                    },
                    subtitle: {
                        text: 'Click and drag to zoom in.'
                    },                    
                    xAxis: {
                        categories: pCategories,
                        crosshair: true
                    },
                    yAxis: {
                        min: 0,
                        title: {
                            text: pYTitle
                        }
                    },
                    tooltip: {
                        headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
                        pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
                            '<td style="padding:0"><b>{point.y} ' + unity + '</b></td></tr>',
                        footerFormat: '</table>',
                        shared: true,
                        useHTML: true
                    },
                    plotOptions: {
                        column: {
                            pointPadding: 0.2,
                            borderWidth: 0
                        }
                    },
                    credits: {
                        enabled: false
                    },
                    series: pSeries
                };
                
                return param ;
            }
            
            ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
            //
            // Data
            //
            ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
            //var u_pstacks = ### STACKS_DETAIL ###
            /* Example:
                {
                 "titles" : ["Nb used reads", "Nb clusters", "Nb validated clusters","Nb reads clustered","Nb secondary reads clustered", "Mean cluster coverage", "Nb polymorphic clusters","Nb reads on polymorphic clusteres","Mean polymorphic cluster coverage"],
                 "samples" : {
                     "PopA_02": [60, 3, 3, 60, 5, 20.0, 1, 12, 12.0], 
                     "PopA_01": [66, 3, 3, 66, 3, 22.0, 1, 18, 18.0], 
                     "PopB_03": [92, 3, 3, 92, 7, 30.67, 1, 38, 38.0]
                    }
                }
            */

            //CSTACKS
            //var cstacks = ### CSTACKS_DETAIL ###
            /* Example:
                {
                 "min_nb_indiv_per_cluster": [[1, 4], [2, 3], [3, 3]], 
                 "evol_cat": [[0, 0], [2, 3], [3, 3]]
                 "summary": {
                    "titles" : ["single loci", "loci merging >= 2 individuals", "loci merging >= 50% individuals", "loci merging 100% individuals"];
                    "details" : [
                        ["loci" ,102632, 10161, 92471, 69459, 21367],
                        ["polymorphic loci", 32222, 369, 31853, 27577, 8061],
                        ["SNPs" , 47451, 543, 46908, 40551, 11946]
                    ]
                 },
                 "nb_haplotype_distribution": [["1", 0], ["2", 11029], ["3", 1376], ["4", 288], [">=5", 132], [">=10", 2]],
                 "nb_snp_distribution": [["1", 9338], ["2", 2416], ["3", 677], ["4", 0], [">=5", 90], [">=10", 1]]
                }
            */
            
            //var sstacks = ### SSTACKS_DETAIL ###
            /* Example:
                {
                    "titles": ["Samples", "population id", "matching loci", "matching haplotype"],
                    "samples": {
                        "EFFICACE_113": ["2", 50822, 54830],
                        "EFFICACE_209": ["2", 48143, 52354],
                        "EFFICACE_43": ["1", 48481, 52541]
                    }
                }
            */
            //var haplotype = ### HAPLOTYPE_DETAIL ###
            /* Example
                {
                    "zygosity_detail": {
                        "titles": ["Sample", "population id", "missing genotype", "heterozygote genotype", "homozygote genotype", "heterozygosity rate (%)"], "samples": {
                            "EFFICACE_113": ["2", 24172, 3710, 45804, 7.49], 
                            "EFFICACE_209": ["2", 26887, 3752, 43047, 8.02], 
                            "EFFICACE_43": ["1", 26615, 3594, 43477, 7.64]
                        }
                    },
                    "summary": {
                        "titles": ["Nb loci genotyped", "Nb loci genotyped by at least 50% of individuals", "Nb polymorphic loci genotyped", "Nb polymorphic loci genotyped by at least 50% of individuals", "Nb polymorphic loci with 1 SNP and 2 alleles"],
                        "values": [73686, 47261, 8729, 7333, 7946]
                    },
                    "min_nb_indiv_per_cluster": {
                        "all loci": [["1", 73686], ["2", 47261], ["3", 22437]],
                        "polymorphic loci": [["1", 8729], ["2", 7333], ["3", 4317]]
                    }
                }
            */
            ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
            //
            // Main
            //
            ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
            /**
             * Disables/enables buttons in datatable.
             */
            var updateButtonState = function(){
                $("#display-spl-lengths").removeClass( "disabled" );
                if( $('input[id^="u-pstacksBySample-chk-"]:checked').length == 0 ){
                    $("#display-spl-lengths").addClass( "disabled" );
                }
            }
            
            /**
             * Draws the bar chart that represents the total number of loci per samples
             * Construct table for detailed statistics about sample clustering
             */
             var u_pstacks_load = function(){
                // Draw histogram of number of whitelisted cluster per sample
                 var sortu_pstacks = new Array();
                 for (var spl_name in u_pstacks["samples"]){
                     sortu_pstacks.push({"sample":spl_name,"nb_clust":u_pstacks["samples"][spl_name][2]});
                 }
                 sortu_pstacks.sort(function(a,b){return a.val - b.val});


                 var samples = new Array();
                 var global_data = new Array();
                 for (var idx in sortu_pstacks){
                     samples.push(sortu_pstacks[idx]["sample"]);
                     global_data.push(sortu_pstacks[idx]["nb_clust"]);
                 }
                 var global_series = [{ name: 'Nb loci', data: global_data }];
                 $('#u-pstacks-summary').highcharts( histogram_param('summary', 'Nb loci', samples, global_series, 'loci') );

                // u-pstacks Detail
                // Table titles
                var titles = ["Samples"]
                for (idx in u_pstacks["titles"] ){
                    titles.push(u_pstacks["titles"][idx])
                }
                $('#u-pstacksBySample-table thead').append( '<tr><th>' + titles.join("</th><th>") + '</th></tr>' );
                $('#u-pstacksBySample-table .title').attr( "colspan", titles.length );
                $('#u-pstacksBySample-table tfoot th').each(function(){
                    $(this).attr( "colspan", titles.length );
                });

                // Table data
                for( var sample_name in u_pstacks["samples"] ){
                    var sample_data = [sample_name] ;
                    for( var idx = 0 ; idx < u_pstacks["samples"][sample_name].length ; idx++){
                        sample_data.push( numberDisplay(u_pstacks["samples"][sample_name][idx]) );
                    }
                    // Add row data
                    $('#u-pstacksBySample-table tbody').append( '<tr><td>' + sample_data.join("</td><td>") + '</td></tr>' );
                }
                
                // Datatable
                $('#u-pstacksBySample-table').DataTable({
                    "sDom": '<"top"<"#u-pstacksBySample-csv-export"><"clear">lf>rt<"bottom"ip><"clear">',
                });
                // Datatable export
                $('#u-pstacksBySample-csv-export').html( '<button class="btn btn-primary"><span class="glyphicon glyphicon-open-file" aria-hidden="true">CSV</span></button>' );
                $('#u-pstacksBySample-csv-export').addClass( 'dataTables_filter' );
                $('#u-pstacksBySample-csv-export').datatableExport({
                    'table_id': "u-pstacksBySample-table"
                });
             }
            
             var cstacks_load = function(){ 
                /**
                 * Draws the line chart that represents the evolution of the number of clusters in the catalog
                 */
                var selected_series = new Array();
                selected_series.push({ "data": cstacks["evol_cat"] });
                $('#cstacks-evol-cat').highcharts( lineplot_param("catalog evolution with the number of individual added", "line", "Nb individual", "Nb clusters", false, selected_series ));
                
                /**
                * Draws the line chart that represents number of cluster agregatting X samples
                */
                var selected_series = new Array();
                selected_series.push({ "data": cstacks["min_nb_indiv_per_cluster"] });
                $('#cstacks-nb_sample_per_clust').highcharts( lineplot_param("Cstacks merging cluster distribution", "area", "Minimum number of samples", "Number of clusters", false, selected_series ));

                /**
                * Cstacks Table
                */
                var titles = [""]
                for (idx in cstacks["summary"]["titles"]){
                    titles.push(cstacks["summary"]["titles"][idx])
                }
                $('#cstacksByCluster-table thead').append( '<tr><th>' + titles.join("</th><th>") + '</th></tr>' );
                $('#cstacksByCluster-table .title').attr( "colspan", titles.length );
                $('#cstacksByCluster-table tfoot th').each(function(){
                    $(this).attr( "colspan", titles.length );
                });

                for (var cat in cstacks["summary"]["details"]){
                    var cat_data = [[cstacks["summary"]["details"][cat][0]]];
                    for (var rank = 1 ; rank < cstacks["summary"]["details"][cat].length ; rank++ ){
                        cat_data.push( numberDisplay(cstacks["summary"]["details"][cat][rank]) );    
                    }
                    $('#cstacksByCluster-table tbody').append( '<tr><td>' + cat_data.join("</td><td>") + '</td></tr>' );
                }
                // Datatable
                $('#cstacksByCluster-table').DataTable({
                    order: [],
                    paging: false,
                    bFilter : false,
                    info : false
                });
                
                /*
                * CSTACKS histogram of snp / haplotype number distribution
                */
                 var categories = new Array();
                 var snp_series = new Array();
                 var hap_series = new Array();
                 for (var idx = 0 ; idx < cstacks["nb_snp_distribution"].length ; idx++){
                    categories.push(cstacks["nb_snp_distribution"][idx][0]);
                    snp_series.push(cstacks["nb_snp_distribution"][idx][1]);
                    hap_series.push(cstacks["nb_haplotype_distribution"][idx][1]);
                 }
                 var global_series = new Array();
                 global_series.push({name:"nb SNP",data:snp_series});
                 global_series.push({name:"nb haplotype",data:hap_series});
                $('#cstacks-nb-snp-hap-dist').highcharts( histogram_param('Nb SNP/haplotype per polymorphic loci distribution', 'Nb loci', categories, global_series, 'loci') );

            }

            var sstacks_load = function(){ 
                /**
                * Sstacks Table
                */
                // Table titles
                $('#sstacksMatches-table thead').append( '<tr><th>' + sstacks["titles"].join("</th><th>") + '</th></tr>' );
                $('#sstacksMatches-table .title').attr( "colspan", sstacks["titles"].length );
                $('#sstacksMatches-table tfoot th').each(function(){
                    $(this).attr( "colspan", sstacks["titles"].length );
                });
                
                // Table data
                for( var sample_name in sstacks["samples"] ){
                    var sample_data = [sample_name] ;
                    for( var idx = 0 ; idx < sstacks["samples"][sample_name].length ; idx++){
                        if (typeof sstacks["samples"][sample_name][idx] == "string"){
                            sample_data.push(sstacks["samples"][sample_name][idx])
                        }else{
                            sample_data.push( numberDisplay(sstacks["samples"][sample_name][idx]) );    
                        }
                    }
                    // Add row data
                    $('#sstacksMatches-table tbody').append( '<tr><td>' + sample_data.join("</td><td>") + '</td></tr>' );
                }
                
                // Datatable
                $('#sstacksMatches-table').DataTable({
                    "sDom": '<"top"<"#sstacksMatches-csv-export"><"clear">lf>rt<"bottom"ip><"clear">',
                });
                $('#sstacksMatches-csv-export').addClass( 'dataTables_filter' );
                $('#sstacksMatches-csv-export').html( '<button class="btn btn-primary"><span class="glyphicon glyphicon-open-file" aria-hidden="true">CSV</span></button>' );
                $('#sstacksMatches-csv-export').datatableExport({
                    'table_id': "sstacksMatches-table"
                });
            }
            var haplotype_load = function(){
                /**
                * Haplotype summary
                */
                var el = document.getElementById("haplotype_summary");
                var text = "";
                for (var idx = 0; idx < haplotype["summary"]["titles"].length; idx ++ ){
                   text = text.concat(haplotype["summary"]["titles"][idx]," : <b>",numberDisplay(haplotype["summary"]["values"][idx]),"</b><br>");
                }

                el.innerHTML = text;
                /**
                * Haplotype Table
                */
                // Table titles
                $('#haplotype-table thead').append( '<tr><th>' + haplotype["zygosity_detail"]["titles"].join("</th><th>") + '</th></tr>' );
                $('#haplotype-table .title').attr( "colspan", haplotype["zygosity_detail"]["titles"].length );
                $('#haplotype-table tfoot th').each(function(){
                    $(this).attr( "colspan", haplotype["zygosity_detail"]["titles"].length );
                });
                
                // Table data
                for( var sample_name in haplotype["zygosity_detail"]["samples"] ){
                    var sample_data = [sample_name] ;
                    for( var idx = 0 ; idx < haplotype["zygosity_detail"]["samples"][sample_name].length ; idx++){
                        if (typeof haplotype["zygosity_detail"]["samples"][sample_name][idx] == "string"){
                            sample_data.push(haplotype["zygosity_detail"]["samples"][sample_name][idx])
                        }else{
                            sample_data.push( numberDisplay(haplotype["zygosity_detail"]["samples"][sample_name][idx]) );    
                        }
                    }
                    // Add row data
                    $('#haplotype-table tbody').append( '<tr><td>' + sample_data.join("</td><td>") + '</td></tr>' );
                }
                
                // Datatable
                $('#haplotype-table').DataTable({
                    "sDom": '<"top"<"#haplotype-csv-export"><"clear">lf>rt<"bottom"ip><"clear">',
                });
                $('#haplotype-csv-export').addClass( 'dataTables_filter' );
                $('#haplotype-csv-export').html( '<button class="btn btn-primary"><span class="glyphicon glyphicon-open-file" aria-hidden="true">CSV</span></button>' );
                $('#haplotype-csv-export').datatableExport({
                    'table_id': "haplotype-table"
                });

                /*
                * Draw cumulative curve of number of cluster in function of a minimum number of individuals genotyped
                */
                var selected_series = new Array();
                for (var series_name in haplotype["min_nb_indiv_per_cluster"] ){
                    selected_series.push({ "name" : series_name, "data": haplotype["min_nb_indiv_per_cluster"][series_name] });
                }
                $('#haplotype_nb_genotype_per_loci').highcharts( lineplot_param("Cumulative Number of Loci in Function of Number of Individuals", "area", "Minimum number of individuals genotyped", "Number of clusters", true, selected_series ));
            }
            $(function() {
                // Remove alert
                $('#js-alert').remove();
                $('#content').removeClass("hidden");
                
                // Display summary
                if ( typeof u_pstacks !== "undefined") {
                    u_pstacks_load();
                }else if ( typeof cstacks !== "undefined") {
                    cstacks_load();
                }else if ( typeof sstacks !== "undefined") {
                    sstacks_load();
                }else if ( typeof haplotype !== "undefined") {
                    haplotype_load();
                }

                // Add Tab listener
                $('.nav-tabs a').click(function (e) {
                    e.preventDefault();
                    $(this).tab('show');
                    if( $(this).attr('href') == "#u-pstacks-stat" && $('#u-pstacks-stat').hasClass('disabled') ){
                        $('#u-pstacks-stat').removeClass("disabled");
                        u_pstacks_load( );
                    } else if( $(this).attr('href') == "#cstacks-stat" && $('#cstacks-stat').hasClass('disabled') ){
                        $('#cstacks-stat').removeClass("disabled");
                        cstacks_load();
                    }else if( $(this).attr('href') == "#sstacks-stat" && $('#sstacks-stat').hasClass('disabled') ){
                        $('#sstacks-stat').removeClass("disabled");
                        sstacks_load();
                    }else if( $(this).attr('href') == "#haplotype-stat" && $('#haplotype-stat').hasClass('disabled') ){
                        $('#haplotype-stat').removeClass("disabled");
                        haplotype_load();
                    }
                })
            });

        </script>
    </head>
    <body>
        <!-- Alert -->
        <p id="js-alert" class="alert alert-warning">
            javascript is needed to display data.<br />
            If you try to view this data on galaxy please contact your administrator to authorise javascript or download the file to view.
        </p>
        
        <!-- Content : uncomment to activate-->
        <div id="content" class="hidden">
            <ul class="nav nav-tabs">
                <!-- <li role="presentation"><a href="#u-pstacks-stat">### FIRST_STEP_TITLE ### Stat</a></li>-->
                <!-- <li role="presentation"><a href="#cstacks-stat">Cstacks Stat</a></li>-->
                <!-- <li role="presentation"><a href="#sstacks-stat">Sstacks Stat</a></li>-->
                <!-- <li role="presentation"><a href="#haplotype-stat">### HAPLOTYPE_TAB_TITLE ### Stat</a></li>-->
            </ul>
            <div class="tab-content">
                <div id="u-pstacks-stat" role="tabpanel" class="tab-pane disabled">
                    <div id="u-pstacks-summary"></div>
                    <div id="u-pstacks-detail">
                        <table id="u-pstacksBySample-table" class="table table-striped">
                            <thead>
                                <tr>
                                    <th class="title">stacks by sample</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
                <div id="cstacks-stat" role="tabpanel" class="tab-pane disabled">
                    <div id="cstacks-evol-cat"></div>
                    <div id="cstacks-nb_sample_per_clust"></div>
                    <div id="cstacks-detail">
                        <table id="cstacksByCluster-table" class="table table-striped">
                            <thead>
                                <tr>
                                    <th class="title">Cstacks merging cluster summary</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                    <div id="cstacks-nb-snp-hap-dist"></div>
                </div>
                <div id="sstacks-stat" role="tabpanel" class="tab-pane disabled">
                    <div id="sstacks-detail">
                        <table id="sstacksMatches-table" class="table table-striped">
                            <thead>
                                <tr>
                                    <th class="title">Sstacks sample matches</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
                <div id="haplotype-stat" role="tabpanel" class="tab-pane disabled">
                    <p><b>Haplotyping summary</b></p>
                    <p id="haplotype_summary"></p>
                    <div id="haplotype-detail">
                        <table id="haplotype-table" class="table table-striped">
                            <thead>
                                <tr>
                                    <th class="title">Sample zygosity</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                        <div id="haplotype_nb_genotype_per_loci"></div>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>
